/*|-----------------------------------------------------------------------------------
 *|														University of Heidelberg
 *|	  _____ _____  _____      _                     	Department of Geography
 *|	 / ____|_   _|/ ____|    (_)                    	Chair of GIScience
 *|	| |  __  | | | (___   ___ _  ___ _ __   ___ ___ 	(C) 2012
 *|	| | |_ | | |  \___ \ / __| |/ _ \ '_ \ / __/ _ \
 *|	| |__| |_| |_ ____) | (__| |  __/ | | | (_|  __/	Berliner Strasse 48
 *|	 \_____|_____|_____/ \___|_|\___|_| |_|\___\___|	D-69120 Heidelberg, Germany
 *|	        	                                       	http://www.giscience.uni-hd.de
 *|------------------------------------------------------------------------------------*/

/**
 * @author: Oliver Roick, roick@uni-heidelberg.de, Carina Eichler, carina.eichler@uni-heidelberg.de
 * @verion: 0.2
 */
 (function(){OpenRouteService={siteUrl:'http://koenigstuhl.geog.uni-heidelberg.de/ors/',controls:null,map:null,route:null,Ui:null,HTTP_GET_VARS:null,init:function(){OpenLayers.ProxyHost="/cgi-bin/proxy.cgi?url=";OpenRouteService.Preferences.loadPrefs();var geolocationNotification=new Element('h3',{'id':'geolocationNotification'}).update(OpenRouteService.Preferences.translate('geolocationNotification'));document.getElementById('openlayers').appendChild(geolocationNotification);var self=this;if(navigator.geolocation){window.geolocationTimeoutHandler=function(){self.onGeolocationFailure();}
window['geolocationRequestTimeoutHandler']=setTimeout('geolocationTimeoutHandler()',3000);navigator.geolocation.getCurrentPosition(this.onGeolocationSuccess,this.onGeolocationFailure,this.onGeolocationTimeoutCallback);}else{this.onGeolocationFailure();}},onGeolocationSuccess:function(position){clearTimeout(window['geolocationRequestTimeoutHandler']);var element=document.getElementById('geolocationNotification');if(!element){return;}
element.parentNode.removeChild(element);var pt=new OpenLayers.LonLat(position.coords.longitude,position.coords.latitude).transform(new OpenLayers.Projection('EPSG:4326'),new OpenLayers.Projection('EPSG:900913'));this.map=OpenRouteService.Map.initializeMap('openlayers');this.map.moveTo(pt,14);var self=this;var cookieManager=new OpenRouteService.CookieManager();this.map.events.register("movestart",this.map,function(){cookieManager.writeData(self.map);});this.getParams=OpenRouteService.Preferences.applyHttpGetVars(this.map);this.Ui=OpenRouteService.Ui;this.Ui.initialize({map:this.map,getParams:this.getParams});window.waypoints=this.waypoints;if(!window.ORS){window.ORS=OpenRouteService;}},onGeolocationFailure:function(){clearTimeout(window['geolocationRequestTimeoutHandler']);var element=document.getElementById('geolocationNotification');if(element){element.parentNode.removeChild(element);}
this.map=OpenRouteService.Map.initializeMap('openlayers');var cookieManager=new OpenRouteService.CookieManager();cookieManager.loadData(this.map);var self=this;this.map.events.register("movestart",this.map,function(){cookieManager.writeData(self.map);});this.getParams=OpenRouteService.Preferences.applyHttpGetVars(this.map);this.Ui=OpenRouteService.Ui;this.Ui.initialize({getParams:this.getParams,map:this.map});window.waypoints=this.waypoints;if(!window.ORS){window.ORS=OpenRouteService;}}}
Event.observe(window,'load',OpenRouteService.init.bind(OpenRouteService));})();(function(){var namespaces;function updateNS(){namespaces=OpenRouteService.namespaces};OpenRouteService.Util={parseStringToDOM:function(s){if(typeof DOMParser!="undefined"){return(new DOMParser).parseFromString(s,"text/xml");}else if(typeof ActiveXObject!="undefined"){xmlDocument=new ActiveXObject("Microsoft.XMLDOM");xmlDocument.loadXML(s);return xmlDocument;}},serializeToString:function(doc){if(window.XMLSerializer){return new XMLSerializer().serializeToString(doc)}else{return doc.transformNode(doc);}},getElementsByTagNameNS:function(element,ns,tagName){if(element.getElementsByTagNameNS){return element.getElementsByTagNameNS(ns,tagName);}else{var nsTag;for(var x in OpenRouteService.namespaces){if(OpenRouteService.namespaces[x]==ns){nsTag=x;}}
return element.getElementsByTagName(nsTag+':'+tagName);}},doesFileExist:function(url){var http=new XMLHttpRequest();http.open('HEAD',url,false);http.send();return http.status==200;},convertDistToMeters:function(dist,unit){var distanceInMeters=0;switch(unit){case"km":case"KM":distanceInMeters=dist*1000;break;case"mi":case"MI":distanceInMeters=dist*1609.344;break;case"yd":case"YD":distanceInMeters=dist*0.9144;break;default:distanceInMeters=dist;}
return distanceInMeters;},convertDistToDist:function(distance,distanceUnitSrc,distanceUnitDest){var specificDistance=0;var distanceInMeters=OpenRouteService.Util.convertDistToMeters(distance,distanceUnitSrc);switch(distanceUnitDest){case"km":case"KM":specificDistance=distanceInMeters/1000;break;case"mi":case"MI":specificDistance=distanceInMeters/1609.344;break;case"yd":case"YD":specificDistance=distanceInMeters/0.9144;break;default:specificDistance=distanceInMeters;}
return this.round(specificDistance);},round:function(distance){var precision=4;if(distance<0.3){precision=3;}
if(distance>=0.3){precision=2;}
if(distance>2){precision=1;}
if(distance>100){precision=0;}
if(distance>300){precision=-1;}
if(distance>2000){precision=-2;}
var p=Math.pow(10,precision)
return Math.round(distance*p)/p;},readFile:function(file){if(file&&!(window.File&&window.FileReader&&window.FileList&&window.Blob)){return null;}
var done=false;var r=new FileReader();var value;r.readAsText(file);r.onload=function(e){value=5;};value=4;return r.results;},readGetVar:function(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable){return unescape(pair[1]);}}},isPoiCategory:function(term){var typeCategories=OpenRouteService.List.poiTypes.keys();for(var i=0;i<typeCategories.length;i++){var cat=typeCategories[i];if(term==cat){return true;}
var detailedTypes=OpenRouteService.List.poiTypes.get(cat);for(var j=0;j<detailedTypes.length;j++){if(detailedTypes[j]==term){return false;}}}
return null;}}}());OpenRouteService.namespaces={xls:'http://www.opengis.net/xls',sch:'http://www.ascc.net/xml/schematron',gml:'http://www.opengis.net/gml',wps:'http://www.opengis.net/wps/1.0.0',ows:'http://www.opengis.net/ows/1.1',xlink:'http://www.w3.org/1999/xlink',xsi:'http://www.w3.org/2001/XMLSchema-instance',ascc:'http://www.ascc.net/xml/schematron'};OpenRouteService.namespaces.schemata={directoryService:'http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/DirectoryService.xsd',gatewayService:'http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/GatewayService.xsd',locationUtilityService:'http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd',presentationService:'http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/PresentationService.xsd',routeService:'http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/RouteService.xsd',wpsService:'http://www.opengis.net/xls http://schemas.opengis.net/wps/1.0.0/wpsExecute_request.xsd',lineStringService:'http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/base/geometryBasic0d1d.xsd'};OpenRouteService.namespaces.services={geocoding:'http://openls.geog.uni-heidelberg.de/testing2011/geocode',routing:'http://openls.geog.uni-heidelberg.de/testing2011/route',directory:'http://openls.geog.uni-heidelberg.de/testing2011/directory',wps:'http://wasserkuppe.geog.uni-heidelberg.de:8080/deegree3wps/services'};OpenRouteService.namespaces.layerWms='http://129.206.228.72/cached/osm?';OpenRouteService.namespaces.layerMapSurfer='http://129.206.74.245:8001/tms_r.ashx?x=${x}&y=${y}&z=${z}';OpenRouteService.namespaces.layerHs='http://129.206.228.72/cached/hillshade?';OpenRouteService.namespaces.overlayTmc='http://koenigstuhl.geog.uni-heidelberg.de/tmc/wms';OpenRouteService.namespaces.overlayTmcLines='http://openls.geog.uni-heidelberg.de/geoserver/wms';OpenRouteService.convert=(function(){'use strict';var namespaces=OpenRouteService.namespaces;var convert=this;var Util=OpenRouteService.Util;var convert={gml2ol:{pos2lonLat:function(pos,srsOutput){var srsInput=pos.getAttribute('srsName')||'EPSG:4326';window.pos=pos;var position=pos.childNodes[0].nodeValue.split(' ');var positionLonLat=new OpenLayers.LonLat(position[0],position[1]).transform(new OpenLayers.Projection(srsInput),new OpenLayers.Projection(srsOutput));return positionLonLat;},pos2point:function(pos,srsOutput){var srsInput=pos.getAttribute('srsName')||'EPSG:4326';var positionText=pos.childNodes[0].nodeValue;window.pos=pos;window.pt=positionText;var position=positionText.split(' ');var positionPoint=new OpenLayers.Geometry.Point(position[0],position[1]).transform(new OpenLayers.Projection(srsInput),new OpenLayers.Projection(srsOutput));return positionPoint;},lineString2lineString:function(lineString,srsOutput){var self=this;if(lineString.getElementsByTagNameNS){var positions=lineString.getElementsByTagNameNS(namespaces.gml,'pos');}else{var positions=lineString.getElementsByTagName('gml:pos');}
var points=[];$A(positions).each(function(pos){points.push(convert.gml2ol.pos2point(pos,srsOutput));});return new OpenLayers.Geometry.LineString(points);}},ol2gml:{point2pos:function(point,srsInput,srsOutput){},point2point:function(point,srsInput,srsOutput){}},units:{distance2hr:function(distance,uom){distance=parseFloat(distance)
if(uom==OpenRouteService.List.distanceUnitsRoute[0]){if(distance>=1000){uom='KM';distance=distance/1000;distance=OpenRouteService.Util.round(distance);}else{uom='M';}
distance=OpenRouteService.Util.round(distance);return[distance,uom];}else if(uom==OpenRouteService.List.distanceUnitsRoute[1]){if(distance>=1760){uom='MI';distance=distance/1760;distance=OpenRouteService.Util.round(distance);}else{uom='YD';}
return[distance,uom];}}},xls2html:{address2div:function(address){var element=new Element('li',{'class':'address'});var StreetAddress=Util.getElementsByTagNameNS(address,namespaces.xls,'StreetAddress')[0];var Streets=Util.getElementsByTagNameNS(StreetAddress,namespaces.xls,'Street');var Building=Util.getElementsByTagNameNS(StreetAddress,namespaces.xls,'Building')[0];var places=Util.getElementsByTagNameNS(address,namespaces.xls,'Place');var postalCode=Util.getElementsByTagNameNS(address,namespaces.xls,'PostalCode');if(Building){var buildingName=Building.getAttribute('buildingName');var buildingSubdivision=Building.getAttribute('subdivision');if(buildingName!=null){element.appendChild(new Element('span').update(buildingName+' '))}
if(buildingSubdivision!=null){element.appendChild(new Element('span').update(buildingSubdivision+' '))}}
var streetline=0;$A(Streets).each(function(street){var officialName=street.getAttribute('officialName');if(officialName!=null){element.appendChild(new Element('span').update(officialName+' '));streetline++;}});if(Building){var buildingNumber=Building.getAttribute('number');if(buildingNumber!=null){element.appendChild(new Element('span').update(buildingNumber));streetline++;}}
if(streetline>0){element.appendChild(new Element('br'));}
var separator='';if(postalCode[0]){element.appendChild(new Element('span').update(postalCode[0].textContent));separator=' ';}
['MunicipalitySubdivision','Municipality','CountrySecondarySubdivision','CountrySubdivision'].each(function(type){$A(places).each(function(place){if(place.getAttribute('type')===type){var content=place.textContent||place.text;element.appendChild(new Element('span',{'class':'addressElement'}).update(separator+content));separator=', ';}})});if(address){var countryCode=address.getAttribute('countryCode');if(countryCode!=null){element.appendChild(new Element('span').update(', '+countryCode.toUpperCase()));}}
return element;},address2shortText:function(address){var element="";var StreetAddress=Util.getElementsByTagNameNS(address,namespaces.xls,'StreetAddress')[0];var Streets=Util.getElementsByTagNameNS(StreetAddress,namespaces.xls,'Street');var Building=Util.getElementsByTagNameNS(StreetAddress,namespaces.xls,'Building')[0];var places=Util.getElementsByTagNameNS(address,namespaces.xls,'Place');if(Building){var buildingName=Building.getAttribute('buildingName');var buildingSubdivision=Building.getAttribute('subdivision');if(buildingName!=null){element+=buildingName+' ';}
if(buildingSubdivision!=null){element+=buildingSubdivision+' ';}}
$A(Streets).each(function(street){var officialName=street.getAttribute('officialName');if(officialName!=null){element+=officialName+' ';}});$A(places).each(function(place){if(place.getAttribute('type')==='Municipality'){element+=place.textContent||place.text;}});return element;},poi2div:function(poi,poisNearRoute,distanceUnit){var element=new Element('li',{'class':'address'});var poiElement=Util.getElementsByTagNameNS(poi,namespaces.xls,'POI')[0];var poiName=poiElement.getAttribute('POIName');var poiDesc=poiElement.getAttribute('description');poiDesc=poiDesc.substring(0,poiDesc.indexOf(';'));poiDesc=OpenRouteService.Preferences.translate(poiDesc);poiDesc=poiDesc.length>1?' ('+poiDesc+')':'';poiName=poiName.length+poiDesc.length==0?OpenRouteService.Preferences.translate('untitled'):poiName;element.appendChild(new Element('span').update(poiName+poiDesc));if(!poisNearRoute){var distElement=Util.getElementsByTagNameNS(poi,namespaces.xls,'Distance')[0];var poiDist=distElement.getAttribute('value');var distanceUnitSrc=distElement.getAttribute('uom');var dist=OpenRouteService.Util.convertDistToDist(poiDist,distanceUnitSrc,distanceUnit);element.appendChild(new Element('span').update(', '+dist+' '+distanceUnit));}
return element;},poi2shortText:function(poi){var poiElement=Util.getElementsByTagNameNS(poi,namespaces.xls,'POI')[0];var poiName=poiElement.getAttribute('POIName');var poiDesc=poiElement.getAttribute('description');poiDesc=poiDesc.substring(0,poiDesc.indexOf(';'));poiDesc=OpenRouteService.Preferences.translate(poiDesc);poiDesc=poiDesc.length>1?' ('+poiDesc+')':'';poiName=poiName.length+poiDesc.length==0?OpenRouteService.Preferences.translate('untitled'):poiName;return poiName+poiDesc;}}}
return convert;}());OpenRouteService.CookieManager=Class.create({cookieNamePos:"Last-position",cookieNameZoom:"Last-zoomLevel",cookieNameLayer:"Last-mapLayer",cookieNameUnit:"DistanceUnits",cookieNameLanguage:"Language",cookieNameVersion:"Version",writeCookie:function(position,zoomLvl,mapLayer){var exdate=new Date();exdate.setDate(exdate.getDate()+30);document.cookie=this.cookieNamePos+"="+escape(position)+";expires="+exdate.toUTCString();document.cookie=this.cookieNameZoom+"="+escape(zoomLvl)+";expires="+exdate.toUTCString();document.cookie=this.cookieNameLayer+"="+escape(mapLayer)+";expires="+exdate.toUTCString();},readCookies:function(){var cName,cValue;var dataArr=new Array();var allCookies=document.cookie.split(";");for(var i=0;i<allCookies.length;i++){if(!String.prototype.trim){cName=allCookies[i].substr(0,allCookies[i].indexOf("=")).replace(/^\s+|\s+$/g,'');}else{cName=allCookies[i].substr(0,allCookies[i].indexOf("=")).trim();}
cValue=allCookies[i].substr(allCookies[i].indexOf("=")+1);var arr=[cName,unescape(cValue)];dataArr.push(arr);}
return dataArr;},readCookie:function(name){if(!name){return null;}
var allCookies=document.cookie;if(allCookies.indexOf(name)==-1){return null;}
var indFirst=allCookies.indexOf(name)+name.length;var cutStart=allCookies.substring(indFirst);var indLast=cutStart.indexOf(';')!=-1?cutStart.indexOf(';'):cutStart.length;var cookieData=cutStart.substring(1,indLast);return cookieData;},writeData:function(map){var zoomLvl=map.getZoom();var position=map.getCenter();position=position.lon+","+position.lat;var currentLayer=map.baseLayer.id;var arr=map.layers;var mapLayer=0;for(var i=0;i<arr.length;i++){if(arr[i].id==currentLayer){mapLayer=i;i=arr.length;}}
this.writeCookie(position,zoomLvl,mapLayer);},loadData:function(map){var position,zoomLvl,layer;var arr=this.readCookies();for(var i=0;i<arr.length;i++){if(arr[i][0]==this.cookieNamePos){var posDat=arr[i][1].split(',');position=new OpenLayers.LonLat(posDat[0],posDat[1]);}else if(arr[i][0]==this.cookieNameZoom){zoomLvl=arr[i][1];}else if(arr[i][0]==this.cookieNameLayer){layer=arr[i][1];}}
position=position==null?new OpenLayers.LonLat(8.692953,49.409445).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")):position;zoomLvl=isNaN(zoomLvl)?13:zoomLvl;var layerArr=map.layers;layer=(isNaN(layer)||layer>=layerArr.length)?layerArr[0]:layerArr[layer];map.setBaseLayer(layer);map.setCenter(position,zoomLvl);},writeSitePrefs:function(arr){var language=arr[0];var unit=arr[1];var version=arr[2];var exdate=new Date();exdate.setDate(exdate.getDate()+30);document.cookie=this.cookieNameLanguage+"="+escape(language)+";expires="+exdate.toUTCString();document.cookie=this.cookieNameUnit+"="+escape(unit)+";expires="+exdate.toUTCString();document.cookie=this.cookieNameVersion+"="+escape(version)+";expires="+exdate.toUTCString();}});OpenRouteService.OpenLS=Class.create({xmlRequest:null,xmlResponse:null,hasErrors:false,getRequestWriter:function(language){var ns=OpenRouteService.namespaces;var writer=new XMLWriter('UTF-8','1.0');writer.writeStartDocument();writer.writeElementString('xls:XLS');writer.writeAttributeString('xmlns:xls',ns.xls);writer.writeAttributeString('xsi:schemaLocation',this.schemaLocation);writer.writeAttributeString('xmlns:sch',ns.ascc);writer.writeAttributeString('xmlns:gml',ns.gml);writer.writeAttributeString('xmlns:xlink',ns.xlink);writer.writeAttributeString('xmlns:xsi',ns.xsi);writer.writeAttributeString('version','1.1');writer.writeAttributeString('xls:lang',language);writer.writeElementString('xls:RequestHeader');return writer;},finishRequest:function(writer){writer.writeEndDocument();var xmlRequest=writer.flush();writer.close();return xmlRequest;},requestData:function(successCallback){var self=this;var requestCallback=function(){if(request.responseXML){self.xmlResponse=request.responseXML;}else{self.xmlResponse=OpenRouteService.Util.parseStringToDOM(request.responseText);}
if(request.status!=200||!self.xmlResponse){self.hasErrors=true;}};var request=OpenLayers.Request.POST({url:this.serviceUrl,data:this.xmlRequest,callback:requestCallback,success:successCallback});}});OpenRouteService.OpenLS.Geocode=Class.create(OpenRouteService.OpenLS,{initialize:function(){this.serviceUrl=OpenRouteService.namespaces.services.geocoding;this.schemaLocation=OpenRouteService.namespaces.schemata.locationUtilityService;},buildRequest:function(address,language){var writer=this.getRequestWriter(language);writer.writeStartElement('xls:Request');writer.writeAttributeString('methodName','GeocodeRequest');writer.writeAttributeString('version','1.1');writer.writeAttributeString('requestID','00');writer.writeStartElement('xls:GeocodeRequest');writer.writeStartElement('xls:Address');writer.writeAttributeString('countryCode',language);writer.writeElementString('xls:freeFormAddress',address);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();this.xmlRequest=this.finishRequest(writer);},getResponse:function(options,resultClickOperation){var searchResults=[];if(this.xmlResponse){var geocodeResponseList=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,OpenRouteService.namespaces.xls,'GeocodeResponseList');var europeBbox=new OpenLayers.Bounds(-31.303,34.09,50.455,71.869).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));$A(geocodeResponseList).each(function(geocodeResponse){$A(OpenRouteService.Util.getElementsByTagNameNS(geocodeResponse,OpenRouteService.namespaces.xls,'GeocodedAddress')).each(function(geocodedAddress){var point=OpenRouteService.Util.getElementsByTagNameNS(geocodedAddress,OpenRouteService.namespaces.gml,'Point')[0];var position=OpenRouteService.Util.getElementsByTagNameNS(point,OpenRouteService.namespaces.gml,'pos')[0];var address=OpenRouteService.Util.getElementsByTagNameNS(geocodedAddress,OpenRouteService.namespaces.xls,'Address')[0];var result=new OpenRouteService.Gui.SearchResult.Place(options,point,address,position);if(europeBbox.containsLonLat(result.lonlat)){searchResults.push(result);result.setResultClickOperation(resultClickOperation);}});});}
return searchResults;}});OpenRouteService.OpenLS.Geolocation=Class.create(OpenRouteService.OpenLS,{initialize:function(){this.serviceUrl=OpenRouteService.namespaces.services.geocoding;this.schemaLocation=OpenRouteService.namespaces.schemata.locationUtilityService;},buildRequest:function(lon,lat,language){var writer=this.getRequestWriter(language);writer.writeStartElement('xls:Request');writer.writeAttributeString('methodName','ReverseGeocodeRequest');writer.writeAttributeString('version','1.1');writer.writeAttributeString('requestID','00');writer.writeAttributeString('maximumResponses','15');writer.writeStartElement('xls:ReverseGeocodeRequest');writer.writeStartElement('xls:Position');writer.writeStartElement('gml:Point');writer.writeAttributeString('xmlns:gml',OpenRouteService.namespaces.gml);writer.writeStartElement('gml:pos');writer.writeAttributeString('srsName','EPSG:4326');writer.writeString(lon+' '+lat);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();this.xmlRequest=this.finishRequest(writer);},getResponse:function(options){var point=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,OpenRouteService.namespaces.gml,'Point')[0];var address=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,OpenRouteService.namespaces.xls,'Address')[0];var position=OpenRouteService.Util.getElementsByTagNameNS(point,OpenRouteService.namespaces.gml,'pos')[0];var result=new OpenRouteService.Gui.SearchResult.Place(options,point,address,position);return result;}});OpenRouteService.OpenLS.Poi=Class.create(OpenRouteService.OpenLS,{initialize:function(){this.serviceUrl=OpenRouteService.namespaces.services.directory;this.schemaLocation=OpenRouteService.namespaces.schemata.directoryService;},buildRequest:function(language,searchQuery,refPoint,maxDist){var writer=this.getRequestWriter(language);writer.writeStartElement('xls:Request');writer.writeAttributeString('methodName','DirectoryRequest');writer.writeAttributeString('version','1.1');writer.writeAttributeString('requestID','00');writer.writeAttributeString('maximumResponses','100');writer.writeStartElement('xls:DirectoryRequest');writer.writeAttributeString('distanceUnit','M');writer.writeAttributeString('sortCriteria','Distance');var generalTermSearchQuery=OpenRouteService.Preferences.reverseTranslate(searchQuery);if(null!=OpenRouteService.Util.isPoiCategory(generalTermSearchQuery)){writer.writeStartElement('xls:POILocation');if(refPoint.length==1){this.buildRequestSearchOnScreen(writer,refPoint[0],maxDist);}else{this.buildRequestSearchNearRoute(writer,refPoint);}
writer.writeEndElement();}
writer.writeStartElement('xls:POIProperties');writer.writeAttributeString('directoryType','OSM');writer.writeStartElement('xls:POIProperty');var isCategory=OpenRouteService.Util.isPoiCategory(generalTermSearchQuery);if(isCategory==true){writer.writeAttributeString('name','Keyword');writer.writeAttributeString('value',generalTermSearchQuery);}else if(isCategory==false){writer.writeAttributeString('name','NAICS_type');writer.writeAttributeString('value',generalTermSearchQuery);}else{writer.writeAttributeString('name','POIName');writer.writeAttributeString('value',searchQuery);}
writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();this.xmlRequest=this.finishRequest(writer);},buildRequestSearchOnScreen:function(writer,refPoint,maxDist){var distanceUnit;if(OpenRouteService.Preferences.distanceUnit.indexOf('yd')!=-1||OpenRouteService.Preferences.distanceUnit.indexOf('YD')!=-1){distanceUnit='YD';}else{distanceUnit='M';}
writer.writeStartElement('xls:WithinDistance');writer.writeStartElement('xls:Position');writer.writeStartElement('gml:Point');writer.writeElementString('gml:pos',refPoint.lon+" "+refPoint.lat);writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('xls:MinimumDistance');writer.writeAttributeString('value','0');writer.writeAttributeString('uom',distanceUnit);writer.writeEndElement();writer.writeStartElement('xls:MaximumDistance');writer.writeAttributeString('value',maxDist);writer.writeAttributeString('uom',distanceUnit);writer.writeEndElement();writer.writeEndElement();},buildRequestSearchNearRoute:function(writer,refPoint){writer.writeStartElement('xls:WithinBoundary');writer.writeStartElement('xls:AOI');writer.writeStartElement('gml:Polygon');writer.writeStartElement('gml:exterior');writer.writeStartElement('gml:LinearRing');for(var i=0;i<refPoint.length;i++){writer.writeElementString('gml:pos',refPoint[i].lon+" "+refPoint[i].lat);}
writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();},getResponse:function(options,resultClickOperation){var searchResults=[];if(this.xmlResponse){var geocodeResponseList=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,OpenRouteService.namespaces.xls,'DirectoryResponse');$A(geocodeResponseList).each(function(poiResponse){$A(OpenRouteService.Util.getElementsByTagNameNS(poiResponse,OpenRouteService.namespaces.xls,'POIContext')).each(function(geocodedAddress){var description=OpenRouteService.Util.getElementsByTagNameNS(geocodedAddress,OpenRouteService.namespaces.xls,'POI')[0];description=description.getAttribute("description");description=description.substring(0,description.indexOf(';'));var result=new OpenRouteService.Gui.SearchResult.Poi(options,geocodedAddress,description);searchResults.push(result);result.setResultClickOperation(resultClickOperation);});});}
return searchResults;}});OpenRouteService.OpenLS.Polygon=Class.create(OpenRouteService.OpenLS,{initialize:function(){this.serviceUrl=OpenRouteService.namespaces.services.wps;this.schemaLocation=OpenRouteService.namespaces.schemata.wpsService;},buildRequest:function(routePoints,maxDist){maxDist=((maxDist*360)/40000000)+"";var ns=OpenRouteService.namespaces;var writer=new XMLWriter('UTF-8','1.0');writer.writeStartDocument();writer.writeElementString('wps:Execute');writer.writeAttributeString('service','WPS');writer.writeAttributeString('version','1.0.0');writer.writeAttributeString('store','true');writer.writeAttributeString('status','false');writer.writeAttributeString('xmlns:wps',ns.wps);writer.writeAttributeString('xmlns:ows',ns.ows);writer.writeAttributeString('xmlns:xlink',ns.xlink);writer.writeAttributeString('xmlns:xsi',ns.xsi);writer.writeAttributeString('xsi:schemaLocation',this.schemaLocation);writer.writeElementString('ows:Identifier','Buffer');writer.writeStartElement('wps:DataInputs');writer.writeStartElement('wps:Input');writer.writeElementString('ows:Identifier','GMLInput');writer.writeElementString('ows:Title','Input Geometry to be buffered');writer.writeStartElement('wps:Data');writer.writeStartElement('wps:ComplexData');writer.writeStartElement('LineString');writer.writeAttributeString('gml:id','route');writer.writeAttributeString('xmlns',ns.gml);writer.writeAttributeString('xmlns:gml',ns.gml);writer.writeAttributeString('srsName','EPSG:4326');writer.writeAttributeString('xmlns:xsi',ns.xsi);writer.writeAttributeString('xsi:schemaLocation',ns.schemata.lineStringService);writer.writeStartElement('gml:posList');writer.writeAttributeString('dimension','2');var posListValue="";routePoints.forEach(function(element,index,array){posListValue+=element.x+" "+element.y+" ";}.bind(this));writer.writeString(posListValue)
writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('wps:Input');writer.writeElementString('ows:Identifier','BufferDistance');writer.writeElementString('ows:Title','BufferDistance');writer.writeStartElement('wps:Data');writer.writeStartElement('wps:LiteralData');writer.writeAttributeString('uom','unity');writer.writeAttributeString('dataType','double');writer.writeString(maxDist);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('wps:OutputDefinitions');writer.writeStartElement('wps:Output');writer.writeElementString('ows:Identifier','GMLOutput');writer.writeElementString('ows:Title','BufferedGeometry');writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();this.xmlRequest=writer.flush();writer.close();},getResponse:function(options,resultClickOperation){var responseTag=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,OpenRouteService.namespaces.gml,'posList');var pointArray=responseTag[0].firstChild.nodeValue.split(" ");var refPoints=[];for(var i=0;i<pointArray.length;i+=2){refPoints.push(new OpenLayers.LonLat(pointArray[i],pointArray[i+1]));}
return refPoints;}});OpenRouteService.OpenLS.Route=Class.create(OpenRouteService.OpenLS,{initialize:function(){this.serviceUrl=OpenRouteService.namespaces.services.routing;this.schemaLocation=OpenRouteService.namespaces.schemata.routeService;},buildRequest:function(routePlan,language){var wayPointList=routePlan.wayPointList;if(!wayPointList||wayPointList.length<2){return;}
var writer=this.getRequestWriter(language);writer.writeStartElement('xls:Request');writer.writeAttributeString('methodName','RouteRequest');writer.writeAttributeString('version','1.1');writer.writeAttributeString('requestID','00');writer.writeAttributeString('maximumResponses','15');writer.writeStartElement('xls:DetermineRouteRequest');writer.writeStartElement('xls:RoutePlan');writer.writeElementString('xls:RoutePreference',routePlan.routePreference||'Fastest');writer.writeStartElement('xls:WayPointList');for(var i=0;i<wayPointList.length;i++){if(i==0){writer.writeStartElement('xls:StartPoint');}else if(i==(wayPointList.length-1)){writer.writeStartElement('xls:EndPoint');}else{writer.writeStartElement('xls:ViaPoint');}
this.generateRequestForWaypoint(wayPointList[i],writer);writer.writeEndElement();};writer.writeEndElement();writer.writeStartElement('xls:AvoidList');if(routePlan.avoidAreas){for(var i=0;i<routePlan.avoidAreas.length;i++){var currentArea=routePlan.avoidAreas[i];writer.writeStartElement('xls:AOI');writer.writeStartElement('gml:Polygon');writer.writeStartElement('gml:exterior');writer.writeStartElement('gml:LinearRing');var corners=currentArea.geometry.components[0].components;for(var j=0;j<corners.length;j++){var pt=new OpenLayers.LonLat(corners[j].x,corners[j].y);pt=pt.transform(new OpenLayers.Projection('EPSG:900913'),new OpenLayers.Projection('EPSG:4326'));writer.writeStartElement('gml:pos');writer.writeString(pt.lon+' '+pt.lat);writer.writeEndElement();}
writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();}}
if(routePlan.avoidMotorways){writer.writeElementString('xls:AvoidFeature','Highway');}
if(routePlan.avoidMotorways){writer.writeElementString('xls:AvoidFeature','Tollway');}
writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('xls:RouteInstructionsRequest');writer.writeAttributeString('provideGeometry','true');writer.writeEndElement();writer.writeElementString('xls:RouteGeometryRequest');writer.writeEndElement();writer.writeEndElement();this.xmlRequest=this.finishRequest(writer);},generateRequestForWaypoint:function(waypoint,writer){writer.writeStartElement('xls:Position');writer.writeStartElement('gml:Point');writer.writeAttributeString('xmlns:gml',OpenRouteService.namespaces.gml)
writer.writeStartElement('gml:pos');writer.writeAttributeString('srsName','EPSG:4326');var coordinates=waypoint.text;if(coordinates==undefined){coordinates=waypoint.firstElementChild.firstChild.nodeValue}
writer.writeString(coordinates);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();},getResponse:function(route){var namespaces=OpenRouteService.namespaces;var mapRepresentation=route.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES)[0];if(this.xmlResponse){var routeGeometry=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,namespaces.xls,'RouteGeometry')[0];if(routeGeometry){route.gmlRepresentation=OpenRouteService.Util.getElementsByTagNameNS(routeGeometry,namespaces.gml,'pos');}
route.olRepresentation=[];$A(route.gmlRepresentation).each(function(pos){route.olRepresentation.push(OpenRouteService.convert.gml2ol.pos2point(pos,route.options.map.getProjection()));});mapRepresentation.removeAllFeatures();route.lineString=new OpenLayers.Geometry.LineString(route.olRepresentation);route.feature=new OpenLayers.Feature.Vector(route.lineString,null);mapRepresentation.addFeatures([route.feature]);var routeSummary=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,namespaces.xls,'RouteSummary');var routeInstructions=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,namespaces.xls,'RouteInstruction');var distUnit=OpenRouteService.Preferences.distanceUnit;if(routeSummary!=null&&routeSummary.length>0){var summaryTime=OpenRouteService.Util.getElementsByTagNameNS(routeSummary[0],namespaces.xls,'TotalTime')[0];summaryTime=summaryTime.textContent||summaryTime.text;var summaryDistance=OpenRouteService.Util.getElementsByTagNameNS(routeSummary[0],namespaces.xls,'TotalDistance')[0];route.RouteSummary=new OpenRouteService.Gui.Collapsible.RouteSummary(summaryTime,summaryDistance,distUnit);if(route.RouteSummaryContainer.firstChild){route.RouteSummaryContainer.firstChild.remove();}
route.RouteSummaryContainer.appendChild(route.RouteSummary.htmlRepresentation);route.RouteSummaryContainer.show();}else{route.RouteSummaryContainer.hide();}
if(routeInstructions!=null&&routeInstructions.length>0){var routeInstructionsList=[];$A(routeInstructions).each(function(routeInstruction){var instruction=OpenRouteService.Util.getElementsByTagNameNS(routeInstruction,namespaces.xls,'Instruction')[0];var distance=OpenRouteService.Util.getElementsByTagNameNS(routeInstruction,namespaces.xls,'distance')[0];var lineString=OpenRouteService.Util.getElementsByTagNameNS(routeInstruction,namespaces.gml,'LineString')[0];var pos=OpenRouteService.Util.getElementsByTagNameNS(routeInstruction,namespaces.gml,'pos')[0];var description=routeInstruction.getAttribute('description').split(' ').reverse()[0];var instructionObj=new OpenRouteService.Gui.Instruction(instruction,distance,lineString,pos,description,distUnit,route);routeInstructionsList.push(instructionObj);});route.RouteInstructions=new OpenRouteService.Gui.Collapsible.RouteInstructions(route.options,routeInstructionsList,route);if(route.RouteInstructionsContainer.firstChild){route.RouteInstructionsContainer.firstChild.remove();}
route.RouteInstructionsContainer.appendChild(route.RouteInstructions.htmlRepresentation);route.RouteInstructionsContainer.show();}else{route.RouteInstructionsContainer.hide();if(route.routeInstructionsLayer!=null){route.routeInstructionsLayer.removeAllFeatures();}
mapRepresentation.removeAllFeatures();this.hasErrors=true;}}else{this.hasErrors=true;route.gmlRepresentation=null;route.olRepresentation=[];mapRepresentation.removeAllFeatures();route.hide();route.RouteInstructionsContainer.hide();route.RouteSummaryContainer.hide();}
route.routePresent=!this.hasErrors;}});OpenRouteService.OpenLS.ReverseGeocode=Class.create(OpenRouteService.OpenLS,{initialize:function(){this.serviceUrl=OpenRouteService.namespaces.services.geocoding;this.schemaLocation=OpenRouteService.namespaces.schemata.locationUtilityService;},buildRequest:function(point,language){var writer=this.getRequestWriter(language);writer.writeStartElement('xls:Request');writer.writeAttributeString('methodName','ReverseGeocodeRequest');writer.writeAttributeString('version','1.1');writer.writeAttributeString('requestID','00');writer.writeAttributeString('maximumResponses','15');writer.writeStartElement('xls:ReverseGeocodeRequest');writer.writeStartElement('xls:Position');writer.writeStartElement('gml:Point');writer.writeAttributeString('xmlns:gml',OpenRouteService.namespaces.gml);writer.writeStartElement('gml:pos');writer.writeAttributeString('srsName','EPSG:4326');var coordinates=point.text;if(coordinates==undefined){coordinates=point.firstElementChild.firstChild.nodeValue}
writer.writeString(coordinates);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();this.xmlRequest=this.finishRequest(writer);},getResponse:function(waypoint){var address=OpenRouteService.Util.getElementsByTagNameNS(this.xmlResponse,OpenRouteService.namespaces.xls,'Address')[0];waypoint.shortTextRepresentation=OpenRouteService.convert.xls2html.address2shortText(address);var addressDiv=OpenRouteService.convert.xls2html.address2div(address);addressDiv.insert(new Element('hr'));waypoint.searchResult.replace(addressDiv);waypoint.searchResult=addressDiv;waypoint.htmlRepresentation.removeClassName('highlight');addressDiv.observe('mouseover',function(){if(waypoint.mapRepresentation){waypoint.route.layerRoutePoints.selectWaypoint.select(waypoint.mapRepresentation);}});addressDiv.observe('mouseout',function(){if(waypoint.mapRepresentation){waypoint.route.layerRoutePoints.selectWaypoint.unselect(waypoint.mapRepresentation);}});}});(function(){var convert=OpenRouteService.convert;var namespaces=OpenRouteService.namespaces;OpenLayers.MarkerEm=OpenLayers.Class(OpenLayers.Marker,{initialize:function(lonlat,deEmIcon,emIcon){var newIcon;this.lonlat=lonlat;newIcon=(deEmIcon)?deEmIcon.clone():OpenLayers.Marker.defaultIcon();if(this.deEmIcon==null){this.deEmIcon=newIcon;}else{this.deEmIcon.url=newIcon.url;this.deEmIcon.size=newIcon.size;this.deEmIcon.offset=newIcon.offset;this.deEmIcon.calculateOffset=newIcon.calculateOffset;}
emIcon=emIcon||deEmIcon;newIcon=(deEmIcon)?deEmIcon.clone():OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=newIcon;}else{this.icon.url=newIcon.url;this.icon.size=newIcon.size;this.icon.offset=newIcon.offset;this.icon.calculateOffset=newIcon.calculateOffset;}
newIcon=(emIcon)?emIcon.clone():OpenLayers.Marker.defaultIcon();if(this.emIcon==null){this.emIcon=newIcon;}else{this.emIcon.url=newIcon.url;this.emIcon.size=newIcon.size;this.emIcon.offset=newIcon.offset;this.emIcon.calculateOffset=newIcon.calculateOffset;}
this.events=new OpenLayers.Events(this,this.icon.imageDiv,null);},emphasise:function(sw){this.icon.size=this.emIcon.size;this.icon.offset=this.emIcon.offset;this.icon.calculateOffset=this.emIcon.calculateOffset;this.icon.setUrl(this.emIcon.url);},deemphasise:function(){this.icon.size=this.deEmIcon.size;this.icon.offset=this.deEmIcon.offset;this.icon.calculateOffset=this.deEmIcon.calculateOffset;this.icon.setUrl(this.deEmIcon.url);},getPixelOnMap:function(map){map.getPixelFromLonLat(this.lonLat);},CLASS_NAME:'OpenLayers.MarkerEm'})
OpenLayers.Layer.PointResults=OpenLayers.Class(OpenLayers.Layer.Markers,{addResult:function(point){var pos=point.getElementsByTagNameNS(namespaces.gml,'pos')[0];var posLonLat=convert.Gml2Ol.pos2lonLat(pos,map.getProjection());var marker=new OpenLayers.MarkerEm(posLonLat,markerIcon,markerIconHighlight);this.addMarker(marker);return marker;},addResultMarker:function(marker){if(false){if(icon){icon=icon.clone();}else{icon=new OpenLayers.Icon('img/searchResultMarker.gif');}
if(iconEm){iconEm=iconEm.clone();}else{iconEm=new OpenLayers.Icon('img/searchResultMarkerEm.gif');}
var pos=point.getElementsByTagNameNS(namespaces.gml,'pos')[0];var posLonLat=convert.gml2ol.pos2lonLat(pos,this.map.getProjection());var marker=new OpenLayers.MarkerEm(posLonLat,icon,iconEm);}
this.addMarker(marker);return marker;},updateResults:function(pointList){this.clearMarkers();var markerList;pointList.each(function(point){markerList.push(this.addResult(point));});return markerList;},getResultPixelBox:function(){var self=this;var pxArray=[];this.markers.each(function(marker,i){pxArray[i]=self.getViewPortPxFromLonLat(marker.lonlat);});var topLeft=pxArray.reduce(function(a,b){var xmin=Math.max(Math.min(a.x,b.x),0);var ymin=Math.max(Math.min(a.y,b.y),0);return new OpenLayers.Pixel(xmin,ymin);});var bottomRight=pxArray.reduce(function(a,b){var xmax=Math.min(Math.max(a.x,b.x),document.viewport.getWidth());var ymax=Math.min(Math.max(a.y,b.y),document.viewport.getHeight());return new OpenLayers.Pixel(xmax,ymax);});return{topLeft:topLeft,bottomRight:bottomRight}}});OpenLayers.MapOrs=OpenLayers.Class(OpenLayers.Map,{numLayers:null,numOverlays:null,zoomBoxToExtent:function(box,bounds,closest){if(box==null||bounds==null){return;}
var b=Object.create(box);if(!box.topLeft)
box.topLeft=[0,0];if(!box.topLeft.x)
box.topLeft.x=box.topLeft[0];if(!box.topLeft.y)
box.topLeft.y=box.topLeft[1];if(!box.bottomRight)
box.bottomRight=[document.viewport.getWidth(),document.viewport.getHeight()];if(!box.bottomRight.x)
box.bottomRight.x=box.bottomRight[0];if(!box.bottomRight.y)
box.bottomRight.y=box.bottomRight[1];b.left=box[0];b.bottom=box[1];b.right=box[2];b.top=box[3];var newBounds={};var v={h:document.viewport.getHeight(),w:document.viewport.getWidth()};newBounds.left=((bounds.left*b.right)-(bounds.right*b.left))/(b.right-b.left);newBounds.top=((bounds.top*b.bottom)-(bounds.bottom*b.top))/(b.bottom-b.top);newBounds.right=((bounds.left*(v.w-b.right))-(bounds.right*(v.w-b.left)))/(b.left-b.right);newBounds.bottom=((bounds.top*(v.h-b.bottom))-(bounds.bottom*(v.h-b.top)))/(b.top-b.bottom);var nb=new OpenLayers.Bounds(newBounds.left,newBounds.bottom,newBounds.right,newBounds.top);this.zoomToExtent(nb,closest);}})
OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{'single':true,'double':true,'pixelTolerance':0,'stopSingle':false,'stopDouble':false},handleRightClicks:true,initialize:function(options){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,this.eventMethods,this.handlerOptions);},CLASS_NAME:"OpenLayers.Control.Click"});}());OpenRouteService.VERSION_STANDARD='standardVersion';OpenRouteService.VERSION_EXTENDED='extendedVersion';OpenRouteService.List={languages:['de','en'],distanceUnits:['m','km','yd','mi'],distanceUnitsRoute:['m / km','yd / mi'],poiCategories:['amenity','public_tran','shop','tourism','leisure','sport'],poiTypes:new Hash({'amenity':['atm','bank','bureau_de_change','biergarten','bus_station','cafe','cinema','college','courthouse','fast_food','fuel','hospital','library','nightclub','parking','pharmacy','place_of_worship','police','post_box','post_office','pub','public_building','restaurant','school','taxi','telephone','theatre','toilets','townhall','university'],'public_tran':['bus_stop','bus_station','railway_station','tram_stop','subway_entrance','parking'],'shop':['supermarket','convenience','bakery','butcher','kiosk'],'tourism':['information','hotel','motel','guest_house','hostel','camp_site','caravan_site','chalet','viewpoint'],'leisure':['sports_centre','golf_course','stadium','track','pitch','water_park','marina','slipway','fishing','nature_reserve','park','playground','garden','ice_rink','miniature_golf'],'sport':['9pin','10pin','archery','athletics','australian_football','baseball','basketball','beachvolleyball','boules','bowls','canoe','chess','climbing','cricket','cricket_nets','croquet','cycling','diving','dog_racing','equestrian','football','golf','gymnastics','hockey','horse_racing','korfball','motor','orienteering','paddle_tennis','squash','paragliding','pelota','racquet','rowing','rugby','shooting','skating','skateboard','skiing','soccer','swimming','table_tennis','team_handball','tennis','volleyball']}),routePreferences:new Hash({'car':['Fastest','Shortest'],'bicycle':['Bicycle','BicycleSafety','BicycleRoute','BicycleMTB','BicycleRacer'],'pedestrian':['Pedestrian']}),routePreferencesImages:new Hash({'car':['img/picto-car.png','img/picto-car-high.png'],'bicycle':['img/picto-bike.png','img/picto-bike-high.png'],'pedestrian':['img/picto-dude.png','img/picto-dude-high.png']}),version:[OpenRouteService.VERSION_STANDARD,OpenRouteService.VERSION_EXTENDED]};OpenRouteService.Map={map:null,numLayers:null,numOverlays:null,initializeMap:function(container,options){OpenLayers.ImgPath="OpenLayersTheme/dark/";options=options||{};options.controls=options.controls||[];options.maxResolution=options.maxResolution||156543.0339;options.units=options.units||'m';options.projection=options.projection||new OpenLayers.Projection('EPSG:900913');options.displayProjection=options.displayProjection||new OpenLayers.Projection('EPSG:4326');options.maxExtent=options.maxExtent||new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508);options.panDuration=options.panDuration||15;options.theme=options.theme||OpenLayers.ImgPath+'/style.css';this.map=new OpenLayers.MapOrs(container,options);this.addControls();this.addLayers();this.map.numLayers=this.numLayers;this.map.numOverlays=this.numOverlays;return this.map;},addControls:function(){this.map.addControl(new OpenLayers.Control.PanZoom());this.map.addControl(new OpenLayers.Control.ArgParser());this.map.addControl(new OpenLayers.Control.Navigation({handleRightClicks:true,dragPanOptions:{documentDrag:true}}));this.map.addControl(new OpenLayers.Control.LayerSwitcher({roundedCorner:'true',roundedCornerColor:'black',id:'layerSwitcherPanel'}));this.map.addControl(new OpenLayers.Control.ScaleLine());this.map.addControl(new OpenLayers.Control.MousePosition());this.map.addControl(new OpenLayers.Control.Permalink());this.map.addControl(new OpenLayers.Control.Attribution());var clickControl=new OpenLayers.Control.Click({eventMethods:{'rightclick':function(e){var menu=new OpenRouteService.Gui.ContextMenu(e.xy.x,e.xy.y).insertIt().setRoute(OpenRouteService.route);},'click':function(e){$$('.contextMenu').each(function(cm){cm.remove();});},'dblclick':function(e){$$('.contextMenu').each(function(cm){cm.remove();});},'dblrightclick':function(e){$$('.contextMenu').each(function(cm){cm.remove();});}}});this.map.addControl(clickControl);clickControl.activate();document.getElementById('openlayers').oncontextmenu=function(e){e=e?e:window.event;if(e.preventDefault)
e.preventDefault();else
return false;};this.map.events.register("zoomend",this.map,closeContextMenu);this.map.events.register("movestart",this.map,closeContextMenu);function closeContextMenu(){$$('.contextMenu').each(function(cm){cm.remove();});};},addLayers:function(){this.numLayers=4;this.numOverlays=3;var osmLayer=new OpenLayers.Layer.OSM();this.map.addLayer(osmLayer);var wms_name="OSM-WMS worldwide";var wms_options={layers:'osm_auto:all',srs:'EPSG:900913',format:'image/png',numZoomLevels:19};var layerOSM=new OpenLayers.Layer.WMS(wms_name,OpenRouteService.namespaces.layerWms,wms_options,{'buffer':2,'attribution':'Maps and data: &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a> and contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});this.map.addLayer(layerOSM);var layerCycle=new OpenLayers.Layer.OSM("OpenCycleMap",["http://a.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png","http://b.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png","http://c.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png"]);this.map.addLayer(layerCycle);var hs_options={layers:'europe_wms:hs_srtm_europa',srs:'EPSG:900913',format:'image/jpeg',transparent:'true'};var hs2=new OpenLayers.Layer.WMS("Hillshade",OpenRouteService.namespaces.layerHs,hs_options);hs2.setOpacity(0.2);hs2.visibility=false;this.map.addLayer(hs2);var layerTMC_lines=new OpenLayers.Layer.WMS("Germany TMC (Streets)",OpenRouteService.namespaces.overlayTmcLines,{'layers':'osm_tmc:lines',srs:'EPSG:31467',transparent:true,format:'image/png',tiled:'true'},{displayInLayerSwitcher:false,visibility:false});this.map.addLayer(layerTMC_lines);var layerTMC=new OpenLayers.Layer.WMS("TMC Germany",OpenRouteService.namespaces.overlayTmc,{layers:'tmc:tmcpoints',styles:'tmcPoint_All',srs:'EPSG:31467',transparent:true,format:'image/png',tiled:'true'},{visibility:false});this.map.addLayer(layerTMC);layerTMC.events.register('visibilitychanged','map',function(e){layerTMC_lines.setVisibility(layerTMC.getVisibility());});var layerRoutePoints=this.initStylesRoutePointLayer();var layerRouteLines=new OpenLayers.Layer.Vector(OpenRouteService.Map.ROUTE_LINES,{displayInLayerSwitcher:false,'style':{strokeColor:"#009ad5",strokeOpacity:1,strokeWidth:5,cursor:"pointer"}});var layerRouteInstructions=new OpenLayers.Layer.Vector(OpenRouteService.Map.ROUTE_INSTRUCTIONS,{displayInLayerSwitcher:false});var layerGeolocation=new OpenLayers.Layer.Markers(OpenRouteService.Map.GEOLOCATION,{displayInLayerSwitcher:false});var layerPoi=new OpenLayers.Layer.Markers(OpenRouteService.Map.POI,{displayInLayerSwitcher:false});var layerSearch=new OpenLayers.Layer.Markers(OpenRouteService.Map.SEARCH,{displayInLayerSwitcher:false});var layerAvoid=new OpenLayers.Layer.Vector(OpenRouteService.Map.AVOID,{displayInLayerSwitcher:false});layerAvoid.redraw(true);var layerTrack=new OpenLayers.Layer.Vector(OpenRouteService.Map.TRACK,{displayInLayerSwitcher:false,'style':{strokeColor:"#2c596b",strokeOpacity:1,strokeWidth:4,cursor:"pointer"}});this.map.addLayers([layerRouteLines,layerTrack,layerRouteInstructions,layerSearch,layerGeolocation,layerPoi,layerRoutePoints,layerAvoid]);},initStylesRoutePointLayer:function(){var styles=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:16,externalGraphic:"http://mnps.org/googlemaps/images/blue.png"}),"select":new OpenLayers.Style({pointRadius:16,externalGraphic:"http://mnps.org/googlemaps/images/orange.png"})});var context={getImageUrl:function(feature){var pointType=feature.pointType;if(OpenRouteService.Gui.icons[pointType]){return OpenRouteService.Gui.icons[pointType].url;}},getHighlightImageUrl:function(feature){var pointType=feature.pointType;if(OpenRouteService.Gui.icons[pointType]){var split=OpenRouteService.Gui.icons[pointType].url.split(".");return split[0]+"-high."+split[1];}}};var template={pointRadius:16,stroke:true,strokeColor:'#ff0000',graphicZIndex:6,externalGraphic:"${getImageUrl}",graphicXOffset:-10,graphicYOffset:-30,graphicWidth:21,graphicHeight:30};var selTemplate={graphicZIndex:10,externalGraphic:"${getHighlightImageUrl}",graphicXOffset:-10,graphicYOffset:-30,graphicWidth:21,graphicHeight:30};var defaultStyle=new OpenLayers.Style(template,{context:context});var selectStyle=new OpenLayers.Style(selTemplate,{context:context});var myStyleMap=new OpenLayers.StyleMap({"default":defaultStyle,"select":selectStyle});var routePoints=new OpenLayers.Layer.Vector(OpenRouteService.Map.ROUTE_POINTS,{styleMap:myStyleMap,displayInLayerSwitcher:false,rendererOptions:{yOrdering:true}});return routePoints},serializeLayers:function(map){layers=map.layers;str='';for(var i=0,len=layers.length;i<len;i++){var layer=layers[i];if(layer.isBaseLayer){str+=(layer==this.map.baseLayer)?"B":"0";}else{str+=(layer.getVisibility())?"T":"F";}}
return str},restoreLayerPrefs:function(map,params){layers=map.layers
var result,indices=[];var baseLayer=params.indexOf('B')>=0?params.indexOf('B'):0;indices.push(baseLayer);var regex=/T/gi;while((result=regex.exec(params))){indices.push(result.index);}
for(var i=0;i<indices.length;i++){if(layers[indices[i]]){layers[indices[i]].setVisibility(true);}}}};OpenRouteService.Map.ROUTE_LINES='routeLines';OpenRouteService.Map.ROUTE_POINTS='routePoints';OpenRouteService.Map.ROUTE_INSTRUCTIONS='routeInstructions';OpenRouteService.Map.GEOLOCATION='Geolocation';OpenRouteService.Map.POI='poi';OpenRouteService.Map.SEARCH='searchResults';OpenRouteService.Map.AVOID='avoidAreas';OpenRouteService.Map.TRACK='track';OpenRouteService.Preferences={language:null,distanceUnit:null,version:null,getParamLanguage:'lang',getParamDistanceUnit:'unit',getParamVersion:'version',dictionary:null,loadPrefs:function(){var cman=new OpenRouteService.CookieManager();this.language=OpenRouteService.Util.readGetVar(this.getParamLanguage);this.distanceUnit=OpenRouteService.Util.readGetVar(this.getParamDistaneUnit);if(!this.language||this.language.length==0){this.language=cman.readCookie(cman.cookieNameLanguage);}
if(!this.distanceUnit||this.distanceUnit.length==0){this.distanceUnit=cman.readCookie(cman.cookieNameUnit);}
if(!this.version||this.version.length==0){this.version=cman.readCookie(cman.cookieNameVersion);}
if(!this.language||this.language.length==0){this.automSetLanguage();}else{this.language=OpenRouteService.List.languages[this.language];}
if(!this.distanceUnit||this.distanceUnit.length==0){this.automSetDistanceUnit();}else{this.distanceUnit=OpenRouteService.List.distanceUnitsRoute[this.distanceUnit];}
if(!this.version||this.version.length==0){this.automSetVersion();}else{this.version=OpenRouteService.List.version[this.version];}
this.dictionary=window['lang_'+this.language];},savePrefs:function(arr){var route=arr[0];var lang=arr[1];var unit=arr[2];var version=arr[3];this.loadPrefs();if(!(this.language==lang&&this.distanceUnit==unit)){new OpenRouteService.CookieManager().writeSitePrefs([lang,unit,version]);OpenRouteService.Preferences.language=OpenRouteService.List.languages[lang];OpenRouteService.Preferences.distanceUnit=OpenRouteService.List.distanceUnitsRoute[unit];OpenRouteService.Preferences.version=OpenRouteService.List.version[version];var query=window.location.search,deviceParam=this.getParamLanguage+"="+lang+"&"+this.getParamDistanceUnit+"="+unit+"&"+this.getParamVersion+"="+version;var layers=OpenRouteService.Map.serializeLayers(route.routeInstance.map);var routeOpt=route.routeInstance.routeOptions.getRoutePreference();var motorways=route.routeInstance.routeOptions.getAvoidMotorways();var tollways=route.routeInstance.routeOptions.getAvoidTollways();var waypoitns=route.routeInstance.serializeWaypoints();deviceParam=deviceParam+"&layers="+layers+"&routeOpt="+routeOpt+"&motorways="+motorways+"&tollways="+tollways+"&waypoints="+waypoitns;query="?"+deviceParam;window.location.search=query;}},automSetLanguage:function(){var userLang=(navigator.language)?navigator.language:navigator.userLanguage;if(userLang.indexOf("de")!=-1){OpenRouteService.Preferences.language='de';}else if(userLang.indexOf("es")!=-1){OpenRouteService.Preferences.language='es';}else if(userLang.indexOf("fr")!=-1){OpenRouteService.Preferences.language='fr';}else{OpenRouteService.Preferences.language='en';}},automSetDistanceUnit:function(){OpenRouteService.Preferences.distanceUnit=OpenRouteService.List.distanceUnitsRoute[0];},automSetVersion:function(){OpenRouteService.Preferences.version=OpenRouteService.List.version[0];},applyHttpGetVars:function(map){var paramsThatCannotBeApplied=[];res=OpenLayers.Util.getParameters();var getVars=new Array();for(var name in res){getVars[name]=res[name];}
var lon=getVars['lon'];var lat=getVars['lat'];var zoom=getVars['zoom'];var layer=getVars['layers'];var routeOpt=getVars['routeOpt'];var motorways=getVars['motorways'];var tollways=getVars['tollways'];var waypoints=getVars['waypoints'];var avoidAreas=getVars['avoidAreas'];if(lon!=undefined&&lat!=undefined){var pos=new OpenLayers.LonLat(lon,lat).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));map.setCenter(pos);}
if(zoom!=undefined){map.zoomTo(zoom);}
if(layer!=undefined){OpenRouteService.Map.restoreLayerPrefs(map,layer);}
if(routeOpt!=undefined){paramsThatCannotBeApplied.routeOpt=routeOpt;}
if(motorways!=undefined){paramsThatCannotBeApplied.motorways=motorways;}
if(tollways!=undefined){paramsThatCannotBeApplied.tollways=tollways;}
if(waypoints!=undefined){paramsThatCannotBeApplied.waypoints=[];if(waypoints.length%2==0){for(var i=0;i<waypoints.length-1;i+=2){var wpArr=[waypoints[i],waypoints[i+1]];paramsThatCannotBeApplied.waypoints.push(wpArr);}}}
if(avoidAreas!=undefined){paramsThatCannotBeApplied.avoidAreas=[];if(avoidAreas.length%2==0){for(var i=0;i<avoidAreas.length-1;i+=2){var wpArr=[avoidAreas[i],avoidAreas[i+1]];paramsThatCannotBeApplied.avoidAreas.push(wpArr);}}}
return paramsThatCannotBeApplied;},translate:function(term){return this.dictionary[term]||'';},reverseTranslate:function(translation){for(var term in this.dictionary){if(this.dictionary.hasOwnProperty(term)){var dictEntry=new Element('text').insert(this.dictionary[term]).innerHTML;if(dictEntry===translation)
return term;}}
return'';}};OpenRouteService.Gui=Class.create({getId:function(){return this.htmlRepresentation.id;},hide:function(){return $(this.htmlRepresentation).hide();},show:function(){return $(this.htmlRepresentation).show();},appendChild:function(element){return this.htmlRepresentation.appendChild(element);},insert:function(container){if(container)
$(container).insert(this.htmlRepresentation);}});var markerSize=new OpenLayers.Size(21,30);var markerOffset=new OpenLayers.Pixel(-10,-30);OpenRouteService.Gui.icons={start:new OpenLayers.Icon('img/marker-start.png',markerSize,markerOffset),via:new OpenLayers.Icon('img/marker-via.png',markerSize,markerOffset),end:new OpenLayers.Icon('img/marker-end.png',markerSize,markerOffset),unset:new OpenLayers.Icon('img/marker.png',markerSize,markerOffset),result:new OpenLayers.Icon('img/marker-poi.png',markerSize,markerOffset),resultEm:new OpenLayers.Icon('img/marker-poi-high.png',markerSize,markerOffset)};OpenRouteService.Gui.poiIcons={icons:new Hash({poi_9pin:new OpenLayers.Icon('img/poi/9pin.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_10pin:new OpenLayers.Icon('img/poi/10pin.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_archery:new OpenLayers.Icon('img/poi/archeery.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_athletics:new OpenLayers.Icon('img/poi/athletics.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_atm:new OpenLayers.Icon('img/poi/atm.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_australian_football:new OpenLayers.Icon('img/poi/australian_football.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_bakery:new OpenLayers.Icon('img/poi/bakery.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_bank:new OpenLayers.Icon('img/poi/bank.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_baseball:new OpenLayers.Icon('img/poi/baseball.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_basketball:new OpenLayers.Icon('img/poi/basketball.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_beachvolleyball:new OpenLayers.Icon('img/poi/beachvolleyball.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_biergarten:new OpenLayers.Icon('img/poi/biergarten.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_boules:new OpenLayers.Icon('img/poi/boules.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_bowls:new OpenLayers.Icon('img/poi/bowls.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_bureau_de_change:new OpenLayers.Icon('img/poi/bureau_de_change.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_bus_station:new OpenLayers.Icon('img/poi/bus_station.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_bus_stop:new OpenLayers.Icon('img/poi/bus_stop.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_butcher:new OpenLayers.Icon('img/poi/butcher.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_cafe:new OpenLayers.Icon('img/poi/cafe.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_canoe:new OpenLayers.Icon('img/poi/canoe.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_chess:new OpenLayers.Icon('img/poi/chess.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_cinema:new OpenLayers.Icon('img/poi/cinema.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_climbing:new OpenLayers.Icon('img/poi/climbing.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_college:new OpenLayers.Icon('img/poi/college.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_convenience:new OpenLayers.Icon('img/poi/convenience.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_courthouse:new OpenLayers.Icon('img/poi/courthouse.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_cricket:new OpenLayers.Icon('img/poi/cricket.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_cricket_nets:new OpenLayers.Icon('img/poi/cricket_nets.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_croquet:new OpenLayers.Icon('img/poi/croquet.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_cycling:new OpenLayers.Icon('img/poi/cycling.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_diving:new OpenLayers.Icon('img/poi/diving.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_dog_racing:new OpenLayers.Icon('img/poi/dog_racing.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_equestrian:new OpenLayers.Icon('img/poi/equestrian.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_fast_food:new OpenLayers.Icon('img/poi/fast_food.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_fishing:new OpenLayers.Icon('img/poi/fishing.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_football:new OpenLayers.Icon('img/poi/football.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_fuel:new OpenLayers.Icon('img/poi/fuel.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_garden:new OpenLayers.Icon('img/poi/garden.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_golf:new OpenLayers.Icon('img/poi/golf.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_golf_course:new OpenLayers.Icon('img/poi/golf.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_guest_house:new OpenLayers.Icon('img/poi/guest_house.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_gymnastics:new OpenLayers.Icon('img/poi/gymnastics.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_hockey:new OpenLayers.Icon('img/poi/hockey.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_horse_racing:new OpenLayers.Icon('img/poi/horse_racing.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_hospital:new OpenLayers.Icon('img/poi/hospital.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_hostel:new OpenLayers.Icon('img/poi/hostel.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_hotel:new OpenLayers.Icon('img/poi/hotel.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_ice_rink:new OpenLayers.Icon('img/poi/ice_rink.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_information:new OpenLayers.Icon('img/poi/information.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_kiosk:new OpenLayers.Icon('img/poi/kiosk.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_korfball:new OpenLayers.Icon('img/poi/korfball.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_library:new OpenLayers.Icon('img/poi/library.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_marina:new OpenLayers.Icon('img/poi/marina.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_miniature_golf:new OpenLayers.Icon('img/poi/miniature_golf.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_motel:new OpenLayers.Icon('img/poi/motel.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_motor:new OpenLayers.Icon('img/poi/motor.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_nature_reserve:new OpenLayers.Icon('img/poi/nature_reserve.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_nightclub:new OpenLayers.Icon('img/poi/nightclub.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_orienteering:new OpenLayers.Icon('img/poi/orienteering.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_paddle_tennis:new OpenLayers.Icon('img/poi/tennis.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_paragliding:new OpenLayers.Icon('img/poi/paragliding.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_park:new OpenLayers.Icon('img/poi/park.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_parking:new OpenLayers.Icon('img/poi/parking.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_pelota:new OpenLayers.Icon('img/poi/pelota.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_pharmacy:new OpenLayers.Icon('img/poi/pharmacy.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_pitch:new OpenLayers.Icon('img/poi/pitch.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_place_of_worship:new OpenLayers.Icon('img/poi/church.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_playground:new OpenLayers.Icon('img/poi/playground.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_police:new OpenLayers.Icon('img/poi/police.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_post_box:new OpenLayers.Icon('img/poi/post_box.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_post_office:new OpenLayers.Icon('img/poi/post_office.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_pub:new OpenLayers.Icon('img/poi/pub.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_public_building:new OpenLayers.Icon('img/poi/public_building.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_raquet:new OpenLayers.Icon('img/poi/racquet.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_railway_station:new OpenLayers.Icon('img/poi/railway_station.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_restaurant:new OpenLayers.Icon('img/poi/restaurant.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_rowing:new OpenLayers.Icon('img/poi/rowing.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_rugby:new OpenLayers.Icon('img/poi/rugby.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_school:new OpenLayers.Icon('img/poi/school.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_shooting:new OpenLayers.Icon('img/poi/shooting.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_skateboard:new OpenLayers.Icon('img/poi/skateboard.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_skating:new OpenLayers.Icon('img/poi/skating.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_skiing:new OpenLayers.Icon('img/poi/skiing.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_slipway:new OpenLayers.Icon('img/poi/slipway.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_soccer:new OpenLayers.Icon('img/poi/soccer.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_sports_center:new OpenLayers.Icon('img/poi/sports_centre.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_squash:new OpenLayers.Icon('img/poi/squash.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_stadium:new OpenLayers.Icon('img/poi/stadium.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_subway_entrance:new OpenLayers.Icon('img/poi/subway_entrance.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_supermarket:new OpenLayers.Icon('img/poi/supermarket.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_swimming:new OpenLayers.Icon('img/poi/swimming.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_table_tennis:new OpenLayers.Icon('img/poi/table_tennis.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_taxi:new OpenLayers.Icon('img/poi/taxi.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_team_handball:new OpenLayers.Icon('img/poi/team_handball.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_telephone:new OpenLayers.Icon('img/poi/telephone.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_tennis:new OpenLayers.Icon('img/poi/tennis.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_theatre:new OpenLayers.Icon('img/poi/theatre.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_toilets:new OpenLayers.Icon('img/poi/toilets.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_townhall:new OpenLayers.Icon('img/poi/townhall.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_track:new OpenLayers.Icon('img/poi/track.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_tram_stop:new OpenLayers.Icon('img/poi/tram_stop.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_university:new OpenLayers.Icon('img/poi/university.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_viewpoint:new OpenLayers.Icon('img/poi/viewpoint.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_volleyball:new OpenLayers.Icon('img/poi/volleyball.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_water_park:new OpenLayers.Icon('img/poi/water_park.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12)),poi_default:new OpenLayers.Icon('img/poi/building_number.png',new OpenLayers.Size(24,24),new OpenLayers.Pixel(-12,-12))}),get:function(name){return this.icons.get(name);}};OpenRouteService.Gui.Instruction=Class.create(OpenRouteService.Gui,{instructionLine:null,instructionPoint:null,htmlRepresentation:null,instructionCell:null,distanceCell:null,initialize:function(instruction,distance,lineString,pos,description,distUnit,route){var lineString=OpenRouteService.convert.gml2ol.lineString2lineString(lineString,route.options.map.getProjection());this.instructionLine=new OpenLayers.Feature.Vector(lineString,null,OpenRouteService.Gui.Instruction.Style.line['default']);var point=OpenRouteService.convert.gml2ol.pos2point(pos,route.options.map.getProjection());this.instructionPoint=new OpenLayers.Feature.Vector(point,null,OpenRouteService.Gui.Instruction.Style.point['default']);this.htmlRepresentation=new Element('tr');this.htmlRepresentation.insert(new Element('td').update(description));if(description%2===0){this.htmlRepresentation.addClassName('even');}else{this.htmlRepresentation.addClassName('odd');}
var content=instruction.textContent||instruction.text;var instructionCell=new Element('td',{'class':'clickable routeInstructions'}).update(content);this.htmlRepresentation.insert(instructionCell);this.instructionCell=instructionCell;var distStr=distance.getAttribute('value');var uom=distance.getAttribute('uom');if(distUnit==OpenRouteService.List.distanceUnitsRoute[0]){var distArr=OpenRouteService.convert.units.distance2hr(distStr,distUnit);}else{var yardsUnit='yd';var distMeasure=OpenRouteService.Util.convertDistToDist(distStr,uom,yardsUnit);var distArr=OpenRouteService.convert.units.distance2hr(distMeasure,distUnit);}
var dist=distArr[0]+' '+distArr[1].toLowerCase();var distCell=new Element('td',{'class':'clickable'}).update(dist);this.htmlRepresentation.insert(distCell);this.distanceCell=distCell;}});OpenRouteService.Gui.Instruction.Style={line:{'default':{strokeColor:"#fba400",strokeWidth:5,strokeOpacity:1,strokeDashstyle:'solid',cursor:"pointer",display:'none',graphicZIndex:1},'select':{strokeColor:"#fba400",strokeWidth:3,strokeOpacity:1,strokeDashstyle:'solid',cursor:"pointer",display:'true',graphicZIndex:4}},point:{'default':{pointRadius:4,fillOpacity:1,strokeWidth:0,strokeColor:'#009ad5',fillColor:'#009ad5',graphicZIndex:2},'select':{pointRadius:6,strokeOpacity:1,strokeWidth:2,strokeColor:'#009ad5',fillColor:'#fba400',graphicZIndex:3}}}
OpenRouteService.Gui.Collapsible=Class.create(OpenRouteService.Gui,{init:function(){this.head=new Element('div',{'class':'collapsibleHead clickable'});this.body=new Element('div',{'class':'collapsibleBody'});this.htmlRepresentation=new Element('div',{'class':'collapsible guiComponent'}).insert(this.head).insert(this.body);this.head.observe('click',this.toggleExpandCollapse.bind(this));},collapse:function(){this.body.hide();this.head.addClassName('collapsed');},expand:function(){this.body.show();this.head.removeClassName('collapsed');},toggleExpandCollapse:function(){if(this.head.hasClassName('collapsed')){this.expand();}else{this.collapse();}}});OpenRouteService.Gui.Collapsible.AvoidAreas=Class.create(OpenRouteService.Gui.Collapsible,{initialize:function(map,layer){var self=this;this.init();this.head.update(OpenRouteService.Preferences.translate('avoidAreas')+':<br>')
this.draw=new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Polygon);this.modify=new OpenLayers.Control.ModifyFeature(layer)
map.addControls([this.draw,this.modify]);this.avoidAreasControl=new Element('div')
this.body.insert(this.avoidAreasControl);this.body.insert(new Element('span',{'class':'clickable'}).update('activate draw control<br />').observe('click',function(){self.draw.activate();}));this.body.insert(new Element('span',{'class':'clickable'}).update('deactivate draw control<br />').observe('click',function(){self.draw.finishSketch();self.draw.deactivate();}));this.body.insert(new Element('span',{'class':'clickable'}).update('activate modify control<br />').observe('click',function(){self.modify.activate();}));}});OpenRouteService.Gui.Collapsible.RouteExtras=Class.create(OpenRouteService.Gui.Collapsible,{routeInstance:null,errorContainer:null,initialize:function(route){this.routeInstance=route;this.init();this.head.update(OpenRouteService.Preferences.translate('routeExtras')+':<br>');var self=this;this.errorContainer=new Element('div',{'class':'alert alert-error'}).hide();this.body.insert(this.errorContainer);var routeLink=new Element('div',{'class':'panel panelMedium'});routeLink.insert(new Element('p').update(OpenRouteService.Preferences.translate('routeLinkText')));var linkBtn=new Element('btn',{'class':'btn'}).update('Permalink');linkBtn.observe('click',function(){self.routeInstance.linkToRoute();});routeLink.insert(linkBtn);this.body.insert(routeLink);this.body.insert(new Element('label').insert('<b>GPX</b>'))
var gpxDownload=new Element('div',{'class':'panel panelMedium'});gpxDownload.insert(new Element('p').update(OpenRouteService.Preferences.translate('gpxDownloadText')));var downloadBtn=new Element('btn',{'class':'btn'}).update('Download GPX');downloadBtn.observe('click',function(){self.routeInstance.writeToGpxFile();});gpxDownload.insert(downloadBtn);this.body.insert(gpxDownload);if(OpenRouteService.Preferences.version!=OpenRouteService.VERSION_EXTENDED){gpxDownload.hide();}
var gpxUpload=new Element('div',{'class':'panel panelMedium'});gpxUpload.insert(new Element('p').update(OpenRouteService.Preferences.translate('gpxUploadRouteText')));var fileChooser=new Element('form',{'class':'fileUploadForm'});var fileUploader=new Element('div',{'id':'gpxUploadFiles','class':'fileupload fileupload-new','data-provides':'fileupload'});fileUploader.insert('<span class="btn btn-file"><span class="fileupload-new">Select file</span><span class="fileupload-exists">Change</span><input type="file" /></span> <span class="fileupload-preview"></span>');var fileUploader_ref=new Element('a',{'href':'#','class':'close fileupload-exists','data-dismiss':'fileupload','style':'float:none'}).insert('x');fileUploader_ref.observe('click',function(){self.routeInstance.deleteGpxFileRoute();})
fileUploader.insert(fileUploader_ref);fileChooser.insert(fileUploader).observe('change',function(){self.routeInstance.readFromGpxFile(true,'gpxUploadFiles');});gpxUpload.insert(fileChooser);this.body.insert(gpxUpload);if(OpenRouteService.Preferences.version!=OpenRouteService.VERSION_EXTENDED){gpxUpload.hide();}
var gpxTrack=new Element('div',{'class':'panel panelMedium'});gpxTrack.insert(new Element('p').update(OpenRouteService.Preferences.translate('gpxUploadTrackText')));var fileChooser=new Element('form',{'class':'fileUploadForm'});var fileUploader=new Element('div',{'id':'gpxUploadTrack','class':'fileupload fileupload-new','data-provides':'fileupload'});fileUploader.insert('<span class="btn btn-file"><span class="fileupload-new">Select file</span><span class="fileupload-exists">Add</span><input type="file" /></span> <span class="fileupload-preview"></span>');var fileUploader_ref=new Element('a',{'href':'#','class':'close fileupload-exists','data-dismiss':'fileupload','style':'float:none'});fileUploader.insert(fileUploader_ref);fileChooser.insert(fileUploader).observe('change',function(){self.routeInstance.readFromGpxFile(false,'gpxUploadTrack');});gpxTrack.insert(fileChooser);this.body.insert(gpxTrack);if(OpenRouteService.Preferences.version!=OpenRouteService.VERSION_EXTENDED){gpxTrack.hide();}}});OpenRouteService.Gui.Collapsible.RouteInstructions=Class.create(OpenRouteService.Gui.Collapsible,{initialize:function(options,routeInstructions,route){var self=this;this.options=options;this.init();this.headContainer=new Element('div');this.headContainer.update('&nbsp;');Element.replace(this.head,this.headContainer);this.head.update(OpenRouteService.Preferences.translate('routeInstructions')+':');this.head.setAttribute('id','routeInstructionHead');this.headContainer.insert(this.head);this.zoomToRouteButton=new Element('div',{'id':'zoomToRouteButton','class':'zoomToRoute clickable'});this.zoomToRouteButton.textContent=OpenRouteService.Preferences.translate('zoomToRoute');this.zoomToRouteButton.observe('click',function(){route.zoomToRoute();});this.headContainer.insert(this.zoomToRouteButton);this.fromTo=new Element('div',{'id':'routeFromTo'});var addText=route.waypoints[route.waypoints.length-1].shortTextRepresentation
this.fromTo.textContent=OpenRouteService.Preferences.translate("routeFromTo")+addText
this.body.insert(this.fromTo);this.instructions=new Element('table');this.body.insert(this.instructions);this.mapRepresentation=route.map.getLayersByName(OpenRouteService.Map.ROUTE_INSTRUCTIONS)[0];this.mapRepresentation.removeAllFeatures();this.instructionPoints=[];this.instructionLines=[];this.distCells=[];this.instructionCells=[];$A(routeInstructions).each(function(instruction){self.instructionLines.push(instruction.instructionLine);self.mapRepresentation.addFeatures([instruction.instructionLine]);self.instructionPoints.push(instruction.instructionPoint);self.mapRepresentation.addFeatures([instruction.instructionPoint]);self.instructionCells.push(instruction.instructionCell);self.distCells.push(instruction.distanceCell);self.instructions.insert(instruction.htmlRepresentation);var style=OpenRouteService.Gui.Instruction.Style;$(instruction.distanceCell).observe('click',function(){self.instructionLines.each(function(line){line.style=style.line['default'];})
self.distCells.reject(function(cell){return cell===instruction.distanceCell}).each(function(distCell){distCell.highlighted=false;distCell.removeClassName('active');});if(instruction.distanceCell.highlighted){instruction.distanceCell.highlighted=false;instruction.instructionLine.style=style.line['default'];instruction.distanceCell.removeClassName('active');}else{instruction.distanceCell.highlighted=true;instruction.instructionLine.style=style.line['select'];instruction.distanceCell.addClassName('active');self.options.map.zoomBoxToExtent(OpenRouteService.Ui.Elements.getFreeSpace(),instruction.instructionLine.geometry.bounds);if(self.options.map.getZoom()>16){self.options.map.zoomTo(16);}}
self.mapRepresentation.redraw();});$(instruction.distanceCell).observe('mouseover',function(){if(!instruction.distanceCell.highlighted){instruction.instructionLine.style=style.line['select'];instruction.distanceCell.addClassName('active');self.mapRepresentation.redraw();}});$(instruction.distanceCell).observe('mouseout',function(){if(!instruction.distanceCell.highlighted){instruction.instructionLine.style=style.line['default'];instruction.distanceCell.removeClassName('active');self.mapRepresentation.redraw();}});$(instruction.instructionCell).observe('click',function(){self.instructionPoints.each(function(point){point.style=style.point['default'];});self.instructionCells.each(function(cell){if(cell!==instruction.instructionCell){cell.highlighted=false;cell.removeClassName('active')}});if(instruction.instructionCell.highlighted){instruction.instructionCell.highlighted=false;instruction.instructionPoint.style=style.point['default'];instruction.instructionCell.removeClassName('active');}else{instruction.instructionCell.highlighted=true;instruction.instructionPoint.style=style.point['select'];instruction.instructionCell.addClassName('active');self.options.map.zoomBoxToExtent(OpenRouteService.Ui.Elements.getFreeSpace(),instruction.instructionPoint.geometry.bounds);if(self.options.map.getZoom()>16){self.options.map.zoomTo(16);}}
self.mapRepresentation.redraw();});$(instruction.instructionCell).observe('mouseover',function(){if(!instruction.instructionCell.highlighted){instruction.instructionPoint.style=style.point['select'];instruction.instructionCell.addClassName('active');self.mapRepresentation.redraw();}});$(instruction.instructionCell).observe('mouseout',function(){if(!instruction.instructionCell.highlighted){instruction.instructionPoint.style=style.point['default'];instruction.instructionCell.removeClassName('active');self.mapRepresentation.redraw();}});});this.collapse();}});OpenRouteService.Gui.Collapsible.RouteOptions=Class.create(OpenRouteService.Gui.Collapsible,{avoidablePanel:null,extendedOptions:null,avoidAreas:[],initialize:function(routeOption,motorwayOption,tollwayOption,avoidAreas,map){var self=this;this.init();this.map=map;this.head.update(OpenRouteService.Preferences.translate('routeOptions')+':<br>');this.avoidablePanel=new Element('div',{'class':'panel panelMedium'});this.insertRoutePreferences();this.setRoutePreference(routeOption);this.insertRouteAvoidables();this.setAvoidMotorways(motorwayOption);this.setAvoidTollways(tollwayOption);this.insertRouteAvoidAreas();this.setAvoidAreas(avoidAreas);},insertRoutePreferences:function(){var mainPrefs=OpenRouteService.List.routePreferences.keys();var preferenceImages=OpenRouteService.List.routePreferencesImages;this.preferenceButtonContainer=new Element('div',{'class':'btn-group routePreferenceBtns'});this.body.insert(this.preferenceButtonContainer);this.extendedOptions=[];for(var i=0;i<mainPrefs.length;i++){var container=new Element('label');var btn=new Element('button',{'id':mainPrefs[i],'class':'btn routeOptionsButton'});var extensions=new Element('div',{'class':'panel panelMedium'});this.extendedOptions.push(extensions);this.body.insert(extensions);var extendedOptions=OpenRouteService.List.routePreferences.get(mainPrefs[i]);for(var j=0;j<extendedOptions.length;j++){var itemContainer=new Element('label',{'class':'radio'});var item=new Element('div');var radio="<input type='radio' id='"+extendedOptions[j]+"' name='"+mainPrefs[i]+"'>"+OpenRouteService.Preferences.translate(extendedOptions[j])+"</input>";item.innerHTML=radio;item.observe('change',function(){document.fire('routePreference:changed');});itemContainer.appendChild(item);extensions.appendChild(itemContainer);}
var self=this;btn.observe('click',function(){var idName=this.getAttribute('id');for(var j=0;j<self.preferenceButtonContainer.childNodes.length;j++){if(idName==self.preferenceButtonContainer.childNodes[j].id){self.preferenceButtonContainer.childNodes[j].innerHTML="<img src='"+preferenceImages.get(idName)[1]+"'/>";if(mainPrefs[j]=='car'){self.avoidablePanel.show();}else{self.avoidablePanel.hide();}
self.extendedOptions[j].show();}else{self.preferenceButtonContainer.childNodes[j].innerHTML="<img src='"+preferenceImages.get(mainPrefs[j])[0]+"'/>";self.extendedOptions[j].hide();}}
document.fire('routePreference:changed');});this.preferenceButtonContainer.appendChild(btn);}},insertRouteAvoidables:function(){var motorContainer=new Element('label',{'class':'checkbox'});this.avoidMotor=new Element('input',{'type':'checkbox','id':'motorways'});motorContainer.insert(this.avoidMotor);motorContainer.insert(OpenRouteService.Preferences.translate('avoidMotorways'));this.avoidablePanel.insert(motorContainer);motorContainer.observe('change',function(){document.fire('routePreference:changed');});var tollContainer=new Element('label',{'class':'checkbox'});this.avoidToll=new Element('input',{'type':'checkbox','id':'motorways'});tollContainer.insert(this.avoidToll);tollContainer.insert(OpenRouteService.Preferences.translate('avoidTollways'));tollContainer.observe('change',function(){document.fire('routePreference:changed');});this.avoidablePanel.insert(tollContainer);this.body.insert(this.avoidablePanel);},insertRouteAvoidAreas:function(){var avoidAreasPanel=new Element('div',{'class':'panel panelMedium','id':'avoidAreas'});this.body.insert(avoidAreasPanel);if(OpenRouteService.Preferences.version!=OpenRouteService.VERSION_EXTENDED){avoidAreasPanel.hide();}
var title=new Element('label',{'id':'avoidAreasTitle'}).insert(OpenRouteService.Preferences.translate('avoidAreas'));avoidAreasPanel.insert(title);var container=new Element('div',{'id':'avoidAreasToolbar','class':'olControlEditingToolbar'});avoidAreasPanel.insert(container);var layerAvoid=this.map.getLayersByName(OpenRouteService.Map.AVOID)[0];var panelPolygon=new OpenLayers.Control.Panel({'displayClass':'olControlEditingToolbar','div':container,'allowDepress':'true',onButtonClick:function(evt){for(key in controlsPolygon){var control=controlsPolygon[key];if(control.panel_div==evt.buttonElement){control.active?control.deactivate():control.activate();}else{control.deactivate();}}
var actives=panelPolygon.getControlsBy('active',true);if(actives&&actives.length>0){var layerRoutePoints=self.map.getLayersByName(OpenRouteService.Map.ROUTE_POINTS)[0];layerRoutePoints.selectWaypoint.deactivate();}else{var layerRoutePoints=self.map.getLayersByName(OpenRouteService.Map.ROUTE_POINTS)[0];layerRoutePoints.selectWaypoint.activate();}}});var self=this;var controlsPolygon={polygon:new OpenLayers.Control.DrawFeature(layerAvoid,OpenLayers.Handler.Polygon,{title:OpenRouteService.Preferences.translate('avoidAreaDraw'),'displayClass':'olControlDrawFeature',featureAdded:function(){document.fire('routePreference:changed');}}),modify:new OpenLayers.Control.ModifyFeature(layerAvoid,{title:OpenRouteService.Preferences.translate('avoidAreaModify'),'displayClass':'olControlModifyFeature',unselectFeature:function(){this.deactivate();this.activate();document.fire('routePreference:changed');}}),remove:new OpenLayers.Control.SelectFeature(layerAvoid,{onSelect:function(feature){layerAvoid.removeFeatures([feature]);document.fire('routePreference:changed');},title:OpenRouteService.Preferences.translate('avoidAreaRemove'),'displayClass':'olControlRemoveFeature'})};for(var key in controlsPolygon){panelPolygon.addControls([controlsPolygon[key]]);}
this.map.addControl(panelPolygon);},getRoutePreference:function(){for(var i=0;i<this.extendedOptions.length;i++){if(this.extendedOptions[i].style.display.length==0){for(var j=0;j<this.extendedOptions[i].childNodes.length;j++){var currentOption=this.extendedOptions[i].childNodes[j].firstChild.firstChild;if(currentOption.checked==true){return currentOption.id;}}}}},setRoutePreference:function(currentOption){var defaultOption;var validOption=false;var mainPrefs=OpenRouteService.List.routePreferences.keys();for(var i=0;i<mainPrefs.length;i++){extendedPrefs=OpenRouteService.List.routePreferences.get(mainPrefs[i]);for(var j=0;j<extendedPrefs.length;j++){if(i==0&&j==0){defaultOption=extendedPrefs[j];}
if(currentOption==extendedPrefs[j]){validOption=true;i=mainPrefs.length;break;}}}
if(validOption==false){currentOption=defaultOption;}
var allTypes=OpenRouteService.List.routePreferences.values();for(var i=0;i<allTypes.length;i++){for(var j=0;j<allTypes[i].length;j++){if(j==0){this.extendedOptions[i].childNodes[j].firstChild.firstChild.checked=true;}
if(allTypes[i][j]==currentOption){this.preferenceButtonContainer.childNodes[i].click();this.extendedOptions[i].childNodes[0].firstChild.firstChild.checked=false;this.extendedOptions[i].childNodes[j].firstChild.firstChild.checked=true;}}}
document.fire('routePreference:changed');},getAvoidMotorways:function(){return this.avoidMotor.checked;},getAvoidTollways:function(){return this.avoidToll.checked;},getAvoidAreas:function(){var layerAvoid=this.map.getLayersByName(OpenRouteService.Map.AVOID)[0];return layerAvoid.features;},getAvoidAreasString:function(){var layerAvoid=this.map.getLayersByName(OpenRouteService.Map.AVOID)[0];var avAreaString="";for(var avAreas=0;avAreas<layerAvoid.features.length;avAreas++){var avAreaPoints=layerAvoid.features[avAreas].geometry.components[0].components;for(var pt=0;pt<avAreaPoints.length;pt++){avAreaString+=avAreaPoints[pt].x+"%2C"+avAreaPoints[pt].y+"%2C";}}
avAreaString=avAreaString.substring(0,avAreaString.length-3);return avAreaString;},setAvoidMotorways:function(option){if(!option){option=false;}else{option=option.toLowerCase()=='true';}
this.avoidMotor.checked=option;},setAvoidTollways:function(option){if(!option){option=false;}else{option=option.toLowerCase()=='true';}
this.avoidToll.checked=option;},setAvoidAreas:function(avoidAreas){if(avoidAreas&&avoidAreas.length>0){var avoidAreasFeatures=[];var layerAvoid=this.map.getLayersByName(OpenRouteService.Map.AVOID)[0];for(var i=0;i<avoidAreas.length;i++){if(avoidAreas[i].length==2){var x=avoidAreas[i][0];var y=avoidAreas[i][1];var pt=new OpenLayers.Geometry.Point(x,y);avoidAreasFeatures.push(pt);if(avoidAreasFeatures.length>1&&avoidAreasFeatures[0].x==pt.x&&avoidAreasFeatures[0].y==pt.y){var poly=new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(avoidAreasFeatures));var featureVec=new OpenLayers.Feature.Vector(poly);featureVec.layer=layerAvoid;layerAvoid.addFeatures([featureVec]);avoidAreasFeatures=[];}}}}}});OpenRouteService.Gui.Collapsible.RouteSummary=Class.create(OpenRouteService.Gui.Collapsible,{distUnit:null,initialize:function(totalTime,totalDistance,distUnit){this.distUnit=distUnit;this.init();this.head.update(OpenRouteService.Preferences.translate('routeSummary')+':');function getTimeString(duration){duration=duration.substring(0,duration.indexOf('M')+1);duration=duration.replace('P','');duration=duration.replace('T','');duration=duration.replace('D',' '+OpenRouteService.Preferences.translate('days')+' ');duration=duration.replace('H',' '+OpenRouteService.Preferences.translate('hours')+' ');duration=duration.replace('M',' '+OpenRouteService.Preferences.translate('minutes')+' ');return duration;}
var distance=totalDistance.getAttribute('value');var uom=totalDistance.getAttribute('uom');var distArr=[];if(this.distUnit==OpenRouteService.List.distanceUnitsRoute[0]){distArr=OpenRouteService.convert.units.distance2hr(distance,this.distUnit);}else{var yardsUnit='yd';var distMeasure=OpenRouteService.Util.convertDistToDist(distance,uom,yardsUnit);distArr=OpenRouteService.convert.units.distance2hr(distMeasure,this.distUnit);}
this.body.insert(new Element('div').update(OpenRouteService.Preferences.translate('TotalTime')+': ~'+getTimeString(totalTime)));this.body.insert(new Element('div').update(OpenRouteService.Preferences.translate('TotalDistance')+': '+distArr[0]+' '+OpenRouteService.Preferences.translate(distArr[1])));}});OpenRouteService.Gui.ContextMenu=Class.create(OpenRouteService.Gui,{dopdownPositionX:0,dropdownPositionY:0,initialize:function(x,y){var self=this;this.htmlRepresentation=new Element('div',{'class':'contextMenu','id':'menuId'});var offsetX=document.getElementById('openlayers').offsetLeft;var offsetY=document.getElementById('openlayers').offsetTop;this.dropdownPositionX=x+offsetX;this.dropdownPositionY=y+offsetY;this.htmlRepresentation.style.top=this.dropdownPositionY+'px';this.htmlRepresentation.style.left=this.dropdownPositionX+'px';this.px=new OpenLayers.Pixel(x,y);var addStartPointText=new Element('span').update(OpenRouteService.Preferences.translate('useAsStartPoint'));var addStartPointDiv=new Element('div',{'class':'useAsStartPoint'}).insert(addStartPointText).observe('mouseover',function(){addStartPointDiv.addClassName('highlight')}).observe('mouseout',function(){addStartPointDiv.removeClassName('highlight')});;this.htmlRepresentation.insert(addStartPointDiv);addStartPointDiv.observe('click',function(){var position=self.route.options.map.getLonLatFromPixel(self.px).transform(new OpenLayers.Projection(self.route.options.map.getProjection()),new OpenLayers.Projection('EPSG:4326'));var wp=self.route.addStartWaypoint();wp.setPosition(position.lon,position.lat);self.removeAll();});var addViaPointText=new Element('span').update(OpenRouteService.Preferences.translate('useAsViaPoint'))
var addViaPointDiv=new Element('div',{'class':'useAsViaPoint'}).insert(addViaPointText).observe('mouseover',function(){addViaPointDiv.addClassName('highlight')}).observe('mouseout',function(){addViaPointDiv.removeClassName('highlight')});this.htmlRepresentation.insert(addViaPointDiv);addViaPointDiv.observe('click',function(){var position=self.route.options.map.getLonLatFromPixel(self.px).transform(new OpenLayers.Projection(self.route.options.map.getProjection()),new OpenLayers.Projection('EPSG:4326'));var wp=self.route.addViaWaypoint();wp.setPosition(position.lon,position.lat);self.removeAll();});var addEndPointText=new Element('span').update(OpenRouteService.Preferences.translate('useAsEndPoint'))
var addEndPointDiv=new Element('div',{'class':'useAsEndPoint'}).insert(addEndPointText).observe('mouseover',function(){addEndPointDiv.addClassName('highlight')}).observe('mouseout',function(){addEndPointDiv.removeClassName('highlight')});this.htmlRepresentation.insert(addEndPointDiv);addEndPointDiv.observe('click',function(){var position=self.route.options.map.getLonLatFromPixel(self.px).transform(new OpenLayers.Projection(self.route.options.map.getProjection()),new OpenLayers.Projection('EPSG:4326'));var wp=self.route.addEndWaypoint();wp.setPosition(position.lon,position.lat);self.removeAll();});return this;},insertIt:function(){this.removeAll();document.body.insert(this.htmlRepresentation);var offsetToBottom=window.innerHeight-(this.dropdownPositionY+this.htmlRepresentation.clientHeight);var offsetToRight=window.innerWidth-(this.dropdownPositionX+this.htmlRepresentation.clientWidth);if(offsetToBottom<3){this.htmlRepresentation.style.top=(this.dropdownPositionY-this.htmlRepresentation.clientHeight)+'px';this.dropdownPositionY-=this.htmlRepresentation.clientHeight;}
if(offsetToRight<3){this.htmlRepresentation.style.left=(this.dropdownPositionX-this.htmlRepresentation.clientWidth)+'px';this.dropdownPositionX-=this.htmlRepresentation.clientWidth;}
return this;},setRoute:function(route){this.route=route;return this;},removeAll:function(){$$('.contextMenu').each(function(cm){cm.remove();});}});OpenRouteService.Gui.Geolocation=Class.create(OpenRouteService.Gui,{result:null,initialize:function(options){var self=this;this.options=options||{};this.mapRepresentation=options.map;this.htmlRepresentation=new Element('div',{'class':'guiComponent geolocation'});this.showCurrentLocation=new Element('div',{'class':'clickable showCurrentLocation','id':'location'}).update(OpenRouteService.Preferences.translate('showCurrentLocation'));this.htmlRepresentation.insert(this.showCurrentLocation);$(this.showCurrentLocation).observe('click',function(){self.determineCurrentLocation();});this.errorBox=new Element('div',{'class':'alert alert-error','id':'geolocationError'}).hide();this.htmlRepresentation.insert(this.errorBox);this.currentPos=new Element('div',{'id':'invisibleCurrentPos'}).hide();this.htmlRepresentation.insert(this.currentPos);document.observe('showCurrentLocation:clicked',function(){var position=document.getElementById('invisibleCurrentPos');self.showLocationOnMap(position);});},determineCurrentLocation:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(this.onGeolocationSuccess,this.onGeolocationError);}else{this.errorBox.update(OpenRouteService.Preferences.translate('geolocationNotSupported'));this.errorBox.show();}},onGeolocationSuccess:function(position){var gmlPosLon='<p>'+position.coords.longitude+'</p>';var gmlPosLat='<p>'+position.coords.latitude+'</p>';gmlPosLon=OpenRouteService.Util.parseStringToDOM(gmlPosLon).firstChild;gmlPosLat=OpenRouteService.Util.parseStringToDOM(gmlPosLat).firstChild;document.getElementById('invisibleCurrentPos').insert(gmlPosLon);document.getElementById('invisibleCurrentPos').insert(gmlPosLat);document.fire('showCurrentLocation:clicked');},onGeolocationError:function(msg){document.getElementById('geolocationError').update(OpenRouteService.Preferences.translate('geolocationRuntimeError'));document.getElementById('geolocationError').show();},showLocationOnMap:function(position){var lon=position.childNodes[0].textContent;var lat=position.childNodes[1].textContent;var self=this;var geolocationService=new OpenRouteService.OpenLS.Geolocation();geolocationService.buildRequest(lon,lat,OpenRouteService.Preferences.language);geolocationService.requestData(function(){self.options.routing=false;self.result=geolocationService.getResponse(self.options);self.result.setResultClickOperation(self.resultClickOperation);Event.observe(self.result.useAsWaypoint,'click',function(){self.useAsWaypoint(self.result);});self.showCurrentLocation.hide();self.resultContainer=new Element('div').update(self.result.htmlRepresentation);self.htmlRepresentation.insert(self.resultContainer);if(self.mapResults){try{self.mapResults.destroy();}catch(e){}}
var layerGeolocation=self.mapRepresentation.getLayersByName(OpenRouteService.Map.GEOLOCATION)[0];layerGeolocation.addMarker(self.result.mapRepresentation);var pt=new OpenLayers.LonLat(lon,lat).transform(new OpenLayers.Projection('EPSG:4326'),new OpenLayers.Projection('EPSG:900913'));self.mapRepresentation.moveTo(pt,14);});},useAsWaypoint:function(selectedSearchResult){var routeInst=this.options.route.routeInstance;var wpCopy=routeInst.getNextAvailableWaypoint();wpCopy.shortTextRepresentation=selectedSearchResult.shortAddress;wpCopy.htmlRepresentation.removeClassName('highlight');selectedSearchResult.useAsWaypoint.hide();var sr=Element.clone(selectedSearchResult.htmlRepresentation,true);selectedSearchResult.useAsWaypoint.show();wpCopy.searchResult.update(sr);sr.removeClassName('highlight');wpCopy.gmlRepresentation=selectedSearchResult.point.cloneNode(true);var pos=OpenRouteService.Util.getElementsByTagNameNS(wpCopy.gmlRepresentation,OpenRouteService.namespaces.gml,'pos')[0];wpCopy.olRepresentation=OpenRouteService.convert.gml2ol.pos2point(pos,wpCopy.options.map.getProjection());sr.observe('mouseover',function(){if(wpCopy.mapRepresentation){wpCopy.route.layerRoutePoints.selectWaypoint.select(wpCopy.mapRepresentation);}});sr.observe('mouseout',function(){if(wpCopy.mapRepresentation){wpCopy.route.layerRoutePoints.selectWaypoint.unselect(wpCopy.mapRepresentation);}});wpCopy.resultMode(selectedSearchResult.lonlat);this.result.hide();var layerGeolocation=this.mapRepresentation.getLayersByName(OpenRouteService.Map.GEOLOCATION)[0];layerGeolocation.clearMarkers();this.showCurrentLocation.show();document.fire('showRoutePanel:clicked');}});OpenRouteService.Gui.Panel=Class.create(OpenRouteService.Gui,{initialize:function(options){var self=this;options=options||{};var panelId=options.id+'Panel'||'none';this.htmlRepresentation=new Element('div',{'id':panelId});this.navTab=new Element('li');this.navTab.innerHTML="<a href='#'><img src='"+options.img+"' class='menuIcon'/>"+options.title+"</a>";this.navTab.observe('click',function(){document.fire('togglePanels:clicked');self.showPanel();});document.getElementById('functionMenu').appendChild(this.navTab);if(options.visible==true||options.visible=='true'){this.showPanel();}else{this.hidePanel();}
document.observe('togglePanels:clicked',function(){self.hidePanel();});},hidePanel:function(){this.navTab.setAttribute('class','');this.htmlRepresentation.hide();},showPanel:function(){this.navTab.setAttribute('class','active');this.htmlRepresentation.show();}});OpenRouteService.Gui.PreferencePopup=Class.create(OpenRouteService.Gui,{htmlRepresentation:null,route:null,initialize:function(route){this.route=route;this.htmlRepresentation=new Element('div',{'id':'sitePrefsModal','class':'modal hide fade','tabindex':'-1','role':'dialog','aria-labelledby':'sitePrefs'});var divHeader=new Element('div',{'class':'modal-header'})
var divBody=new Element('div',{'class':'modal-body'});var divFooter=new Element('div',{'class':'modal-footer'})
this.htmlRepresentation.appendChild(divHeader);this.htmlRepresentation.appendChild(divBody);this.htmlRepresentation.appendChild(divFooter);var closeCross=new Element('a',{'href':'#','class':'close','data-dismiss':'modal','aria-hidden':'true'}).insert('&times;');var title=new Element('h3',{'id':'sitePrefs'}).insert(OpenRouteService.Preferences.translate('sitePreferences'));divHeader.appendChild(closeCross);divHeader.appendChild(title);var heading=new Element('h4').insert(OpenRouteService.Preferences.translate('version'));var text=new Element('p').insert(OpenRouteService.Preferences.translate('versionText'));this.selectionVersion=new Element('select',{'id':'extendedVersionPrefs'});this.buildOptionList(this.selectionVersion,OpenRouteService.List.version,true,OpenRouteService.Preferences.version);text.appendChild(this.selectionVersion);divBody.appendChild(heading);divBody.appendChild(text);var heading=new Element('h4').insert(OpenRouteService.Preferences.translate('language'));var text=new Element('p').insert(OpenRouteService.Preferences.translate('languageText'));this.selectionLang=new Element('select',{'id':'languagePrefs'});this.buildOptionList(this.selectionLang,OpenRouteService.List.languages,true,OpenRouteService.Preferences.language);text.appendChild(this.selectionLang);divBody.appendChild(heading);divBody.appendChild(text);var heading=new Element('h4').insert(OpenRouteService.Preferences.translate('distance'));var text=new Element('p').insert(OpenRouteService.Preferences.translate('distanceText'));this.selectionUnit=new Element('select',{'id':'unitPrefs'});this.buildOptionList(this.selectionUnit,OpenRouteService.List.distanceUnitsRoute,false,OpenRouteService.Preferences.distanceUnit);text.appendChild(this.selectionUnit);divBody.appendChild(heading);divBody.appendChild(text);var closeBtn=new Element('button',{'class':'btn','data-dismiss':'modal','aria-hidden':'true'}).insert(OpenRouteService.Preferences.translate('closeBtn'));var saveBtn=new Element('button',{'class':'btn btn-primary','id':'savePrefsBtn'}).insert(OpenRouteService.Preferences.translate('saveBtn'));var self=this;$(saveBtn).observe('click',function(){self.savePrefs(self.route);jQuery.noConflict();(function($){$('#sitePrefsModal').modal('hide');})(jQuery);});divFooter.appendChild(closeBtn);divFooter.appendChild(saveBtn);},buildOptionList:function(parentElement,listItems,lookUpTranslations,globalParam){var optionItems=[];if(lookUpTranslations){for(var i=0;i<listItems.length;i++){optionItems.push(OpenRouteService.Preferences.translate(listItems[i]));}}else{optionItems=listItems;}
for(var i=0;i<optionItems.length;i++){var option=new Element('option',{'value':i}).insert(optionItems[i]);if(listItems[i]==globalParam){option.setAttribute('selected','true');}
parentElement.appendChild(option);}},savePrefs:function(route){var lang=this.selectionLang.childNodes[0];for(var i=0;i<this.selectionLang.length;i++){if(this.selectionLang.childNodes[i].selected){lang=this.selectionLang.childNodes[i].value;}}
var unit=this.selectionUnit.childNodes[0];for(var i=0;i<this.selectionUnit.length;i++){if(this.selectionUnit.childNodes[i].selected){unit=this.selectionUnit.childNodes[i].value;}}
var version=this.selectionVersion.childNodes[0];for(var i=0;i<this.selectionVersion.length;i++){if(this.selectionVersion.childNodes[i].selected){version=this.selectionVersion.childNodes[i].value;}}
OpenRouteService.Preferences.savePrefs([route,lang,unit,version]);}});OpenRouteService.Gui.Route=Class.create(OpenRouteService.Gui,{NUM_EMPTY_POINTS:2,routePresent:false,waypointsFromGpxFile:[],routeInstructionsLayer:null,map:null,openLSRequestCounter:0,initialize:function(options){OpenRouteService.route=this;this.options=options||{};this.map=options.map;this.initMapFeatures();this.initHtmlRepresentation();this.waypoints=[];var self=this;if(this.options.waypoints&&this.options.waypoints.length>0){this.options.waypoints.each(function(waypoint,i){if(waypoint.length==2){var wp=self.addWaypoint();var lonlat=new OpenLayers.LonLat(parseFloat(waypoint[0]),parseFloat(waypoint[1]));lonlat=lonlat.transform(new OpenLayers.Projection(self.map.getProjection()),new OpenLayers.Projection('EPSG:4326'));wp.setPosition(lonlat.lon,lonlat.lat);}});this.checkWaypointsAndCalcRoute();}
this.addWaypointButton.observe('click',function(){self.addWaypoint();});document.observe('routePreference:changed',function(){self.checkWaypointsAndCalcRoute();});document.observe('routeServerError:clicked',function(){document.getElementById('routeCalculateZoom').setAttribute('class','alert alert-error');document.getElementById('routeCalculateZoom').update(OpenRouteService.Preferences.translate('serverError'));});this.fillUpWaypoints();},initMapFeatures:function(){var self=this;this.layerRoutePoints=this.map.getLayersByName(OpenRouteService.Map.ROUTE_POINTS)[0];var dragRoutePoints=new OpenLayers.Control.DragFeature(this.layerRoutePoints);this.options.map.addControl(dragRoutePoints);dragRoutePoints.activate();dragRoutePoints.onComplete=function(feature,mousePosition){var srsOutput='EPSG:4326';var srsInput=self.options.map.getProjection();var newGeometry=feature.geometry.clone().transform(new OpenLayers.Projection(srsInput),new OpenLayers.Projection(srsOutput));feature.jsRepresentation.setPosition(newGeometry.x,newGeometry.y);}
var selectWaypoint=new OpenLayers.Control.SelectFeature(this.layerRoutePoints,{hover:true,toggle:true,clickout:true});selectWaypoint.onSelect=function(feature){feature.jsRepresentation.htmlRepresentation.addClassName('highlight');};selectWaypoint.onUnselect=function(feature){feature.jsRepresentation.htmlRepresentation.removeClassName('highlight');};this.options.map.addControl(selectWaypoint);selectWaypoint.activate();this.layerRoutePoints.selectWaypoint=selectWaypoint;this.layerRoutePoints.dragRoutePoints=dragRoutePoints;},initHtmlRepresentation:function(){this.htmlRepresentation=new Element('div',{'class':'guiComponent route'});this.routeOptions=new OpenRouteService.Gui.Collapsible.RouteOptions(this.options.routeOpt,this.options.motorways,this.options.tollways,this.options.avoidAreas,this.options.map);this.routeOptions.collapse();var routeOptionsContainer=new Element('div',{'class':'panel panelLight'});routeOptionsContainer.insert(this.routeOptions.htmlRepresentation);this.htmlRepresentation.insert(routeOptionsContainer);this.htmlRepresentation.insert("<br/>");this.resetRouteButton=new Element('div',{'id':'resetRoute','class':'clickable'}).update(OpenRouteService.Preferences.translate('resetRoute'));this.htmlRepresentation.insert(this.resetRouteButton);var self=this;this.resetRouteButton.observe('click',function(){self.resetRoute();});this.htmlRepresentation.insert("<br/>");this.addWaypointButton=new Element('div',{'class':'addWaypoint clickable'}).update(OpenRouteService.Preferences.translate('addWaypoint'));this.routeCalculateZoom=new Element('div',{'id':'routeCalculateZoom'});this.htmlRepresentation.insert(this.addWaypointButton);this.htmlRepresentation.insert(this.routeCalculateZoom);this.RouteSummaryContainer=new Element('div',{'class':'routeSummaryContainer panel panelLight'}).hide();this.htmlRepresentation.insert(this.RouteSummaryContainer);this.RouteInstructionsContainer=new Element('div',{'class':'routeInstructionsContainer panel panelLight'}).hide();this.htmlRepresentation.insert(this.RouteInstructionsContainer);this.routeExtrasContainer=new Element('div',{'class':'routeExtrasContainer panel panelLight'});this.routeExtras=new OpenRouteService.Gui.Collapsible.RouteExtras(this);this.routeExtras.collapse();this.routeExtrasContainer.insert(this.routeExtras.htmlRepresentation);this.htmlRepresentation.insert(this.routeExtrasContainer);},addWaypoint:function(index){if(!index||index>this.waypoints.length){index=this.waypoints.length;}
var newWaypoint=new OpenRouteService.Gui.Waypoint(this.options,this.layerRoutePoints,this);if(this.waypoints.length==0){this.addWaypointButton.insert({before:newWaypoint.htmlRepresentation});}else if(index==0){this.waypoints[0].htmlRepresentation.insert({before:newWaypoint.htmlRepresentation});}else if(index<=this.waypoints.length){this.waypoints[index-1].htmlRepresentation.insert({after:newWaypoint.htmlRepresentation});}
this.waypoints.splice(index,0,newWaypoint);this.setPointTypes();return newWaypoint;},removeWaypoint:function(index){if(index&&index<this.waypoints.length){this.waypoints[index].remove();this.waypoints.splice(index,1);}},fillUpWaypoints:function(){var missingPoints=this.NUM_EMPTY_POINTS-this.waypoints.length;for(var i=0;i<missingPoints;i++){this.addWaypoint();}},addStartWaypoint:function(){if(this.waypoints.length<1){this.addWaypoint();}
return this.waypoints[0];},addViaWaypoint:function(){while(this.waypoints.length<2){this.addWaypoint();}
for(var i=1;i<this.waypoints.length;i++){if(this.waypoints[i].pointType==OpenRouteService.Gui.Waypoint.UNSET&&i!=this.waypoints.length-1){return this.waypoints[i];}}
return this.addWaypoint(this.waypoints.length-1);},addEndWaypoint:function(){if(this.waypoints.length<2){while(this.waypoints.length<2){this.addWaypoint();}}else if(this.waypoints[this.waypoints.length-1].pointType!=OpenRouteService.Gui.Waypoint.UNSET&&this.waypoints[this.waypoints.length-1].pointType!=OpenRouteService.Gui.Waypoint.END){this.addWaypoint();}
return this.waypoints[this.waypoints.length-1];},getNextAvailableWaypoint:function(){for(var i=0;i<this.waypoints.length;i++){if(this.waypoints[i].pointType=='unset'){return this.waypoints[i];}}
return this.addWaypoint();},checkWaypointsAndCalcRoute:function(){var routable=false;if(this.waypoints.length>=2){var numSetWaypoints=0;for(var i=0;i<this.waypoints.length&&routable==false;i++){if(this.waypoints[i].pointType!=OpenRouteService.Gui.Waypoint.UNSET){numSetWaypoints++;if(numSetWaypoints>=2){routable=true;}}}}
if(routable==true){this.requestRoute();}else{this.removeRouteLinesAndDomElements();}},removeRouteLinesAndDomElements:function(){if(this.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES).length>0){var routeLineLayer=this.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES)[0];routeLineLayer.removeAllFeatures();}
if(this.map.getLayersByName(OpenRouteService.Map.ROUTE_INSTRUCTIONS).length>0){var routeInstrLayer=this.map.getLayersByName(OpenRouteService.Map.ROUTE_INSTRUCTIONS)[0];routeInstrLayer.removeAllFeatures();}
if(this.RouteInstructionsContainer){this.RouteInstructionsContainer.hide();}
if(this.RouteSummaryContainer){this.RouteSummaryContainer.hide();}
var el=document.getElementById('routeCalculateZoom');if(el){el.hide();}},resetRoute:function(){while(this.waypoints.length>0){this.waypoints[this.waypoints.length-1].reset();}
this.waypoints=[];this.removeRouteLinesAndDomElements();this.fillUpWaypoints();},requestRoute:function(){this.routeExtras.errorContainer.hide();if(this.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES).length>0){var routeLineLayer=this.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES)[0];routeLineLayer.removeAllFeatures();var routeInstructionsLayer=this.map.getLayersByName(OpenRouteService.Map.ROUTE_INSTRUCTIONS)[0];routeInstructionsLayer.removeAllFeatures();}
this.routeCalculateZoom.setAttribute('style','display:block;');this.routeCalculateZoom.update(OpenRouteService.Preferences.translate('calculatingRoute'));this.routeCalculateZoom.addClassName('alert alert-info searchingBlue');var routePlan={};routePlan.wayPointList=this.getGmlRepresentation();routePlan.routePreference=this.routeOptions.getRoutePreference();routePlan.avoidMotorways=this.routeOptions.getAvoidMotorways();routePlan.avoidTollways=this.routeOptions.getAvoidTollways();routePlan.avoidAreas=this.routeOptions.getAvoidAreas();var self=this;var routeService=new OpenRouteService.OpenLS.Route();routeService.buildRequest(routePlan,OpenRouteService.Preferences.language);this.openLSRequestCounter++;routeService.requestData(function(){self.openLSRequestCounter--;if(self.openLSRequestCounter==0){routeService.getResponse(self);var successful=self.routePresent;if(successful){document.getElementById('routeCalculateZoom').removeClassName('alert alert-info searchingBlue');document.getElementById('routeCalculateZoom').removeClassName('alert alert-error');document.getElementById('routeCalculateZoom').update('');}else{document.getElementById('routeCalculateZoom').setAttribute('class','alert alert-error');document.getElementById('routeCalculateZoom').update(OpenRouteService.Preferences.translate('noRouteAvailable'));}
self.zoomToRoute();document.fire('route:changed');}});},getGmlRepresentation:function(){var gmlRepresentation=[];this.waypoints.each(function(waypoint){var gmlRep=waypoint.gmlRepresentation;if(gmlRep)
gmlRepresentation.push(gmlRep);});return gmlRepresentation;},zoomToRoute:function(){var mapRepresentation=this.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES)[0];var dataExtent=mapRepresentation.getDataExtent()||this.layerRoutePoints.getDataExtent();if(dataExtent){this.options.map.zoomBoxToExtent(OpenRouteService.Ui.Elements.getFreeSpace(),dataExtent);if(this.options.map.getZoom()>14&&this.layerRoutePoints.features.length<2){this.options.map.zoomTo(14);}}},setPointTypes:function(){var len=this.waypoints.length;if(this.waypoints.length>=1){var wp=this.waypoints[0];wp.gmlRepresentation?wp.setPointType(OpenRouteService.Gui.Waypoint.START):wp.setPointType(OpenRouteService.Gui.Waypoint.UNSET);wp.moveUpButton.hide();wp.moveDownButton.show();for(var i=1;i<=len-2;i++){wp=this.waypoints[i];wp.gmlRepresentation?wp.setPointType(OpenRouteService.Gui.Waypoint.VIA):wp.setPointType(OpenRouteService.Gui.Waypoint.UNSET);wp.moveDownButton.show();wp.moveUpButton.show();}
if(len>1){wp=this.waypoints[len-1];wp.gmlRepresentation?wp.setPointType(OpenRouteService.Gui.Waypoint.END):wp.setPointType(OpenRouteService.Gui.Waypoint.UNSET);wp.moveDownButton.hide();wp.moveUpButton.show();}}},writeToGpxFile:function(){this.routeExtras.errorContainer.hide();var formatter=new OpenLayers.Format.GPX({'internalProjection':new OpenLayers.Projection("EPSG:900913")});var routeLayers=this.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES);if(routeLayers&&routeLayers.length>0){var gpxStr=formatter.write(routeLayers[0].features);gpxStr=gpxStr.replace(/></g,'>\n<');w=window.open('about:blank','_blank','height=300,width=400');w.document.write('<xmp>'+gpxStr+'</xmp>');}else{this.routeExtras.errorContainer.update(OpenRouteService.Preferences.translate('gpxDownloadError'));this.routeExtras.errorContainer.show();}},readFromGpxFile:function(calcRoute,id){this.routeExtras.errorContainer.hide();var error=false;var self=this;var fileInput=$$('#'+id+' input[type="file"]')[0];var file=null;if(fileInput&&fileInput.files){file=fileInput.files[0];}else if(fileInput&&fileInput.value){file=fileInput.value;}
if(file){if(!window.FileReader){error=true;}else{var r=new FileReader();r.readAsText(file);r.onload=function(e){var data=e.target.result;data=data.replace(/gpx:/g,'');var formatter=new OpenLayers.Format.GPX({'internalProjection':new OpenLayers.Projection("EPSG:900913")});var featureVectors=formatter.read(data);linePoints=featureVectors[0].geometry.components;if(linePoints&&linePoints.length>=2){var startPos=new OpenLayers.LonLat(linePoints[0].x,linePoints[0].y).transform(new OpenLayers.Projection('EPSG:900913'),new OpenLayers.Projection('EPSG:4326'));var endPos=new OpenLayers.LonLat(linePoints[linePoints.length-1].x,linePoints[linePoints.length-1].y).transform(new OpenLayers.Projection('EPSG:900913'),new OpenLayers.Projection('EPSG:4326'));if(calcRoute){var startWaypoint=self.getNextAvailableWaypoint();startWaypoint.setPosition(startPos.lon,startPos.lat);var endWaypoint=self.getNextAvailableWaypoint();endWaypoint.setPosition(endPos.lon,endPos.lat);self.waypointsFromGpxFile.push(startWaypoint);self.waypointsFromGpxFile.push(endWaypoint);var routeLayers=self.map.getLayersByName(OpenRouteService.Map.ROUTE_LINES);routeLayers[0].addFeatures(featureVectors);}else{var trackLayer=self.map.getLayersByName(OpenRouteService.Map.TRACK);trackLayer[0].addFeatures(featureVectors);}}}}}else{error=true;}
if(error){this.routeExtras.errorContainer.update(OpenRouteService.Preferences.translate('gpxUploadError'));this.routeExtras.errorContainer.show();return;}},deleteGpxFileRoute:function(){for(var i=0;i<this.waypoints.length;i++){for(var j=0;j<this.waypointsFromGpxFile.length;j++){if(this.waypoints[i].equals(this.waypointsFromGpxFile[j])){this.waypoints[i].reset();}}}
this.setPointTypes();this.fillUpWaypoints();this.checkWaypointsAndCalcRoute();},linkToRoute:function(){var layers=OpenRouteService.Map.serializeLayers(this.map);var routeOpt=this.routeOptions.getRoutePreference();var motorways=this.routeOptions.getAvoidMotorways();var tollways=this.routeOptions.getAvoidTollways();var avoidAreas=this.routeOptions.getAvoidAreasString();var waypoitns=this.serializeWaypoints();var query=window.location.search,deviceParam="layers="+layers+"&routeOpt="+routeOpt+"&motorways="+motorways+"&tollways="+tollways+"&waypoints="+waypoitns+"&avoidAreas="+avoidAreas;query="?"+deviceParam;window.open(query);},serializeWaypoints:function(){var str="";for(var i=0;i<this.waypoints.length;i++){var wp=this.waypoints[i];if(wp.olRepresentation){str+=wp.olRepresentation.x+'%2C'+wp.olRepresentation.y+'%2C';}}
str=str.substring(0,str.length-3);return str;}});OpenRouteService.Gui.Search=Class.create(OpenRouteService.Gui,{});OpenRouteService.Gui.Search.DONE_TYPING_INTERVAL=1200;OpenRouteService.Gui.SearchPlace=Class.create(OpenRouteService.Gui,{searchfield:null,responseContainer:null,mapRepresentation:null,resultClickOperation:function(){},results:null,selectedAsWaypoint:-1,openLSRequestCounter:0,initialize:function(options){var self=this;this.options=options||{};this.mapRepresentation=options.map;var selectPrompt=this.options.selectPrompt||'';this.openLSRequestCounter=0;var successCallback=function(){self.updateResults();};this.htmlRepresentation=new Element('div',{'class':'guiComponent Search'});this.searchfield=new Element('input',{'type':'text','class':'searchField','placeholder':OpenRouteService.Preferences.translate('enterAddress')});this.htmlRepresentation.insert(this.searchfield);this.mapResults=new OpenLayers.Layer.Markers('Search Results');this.zoomToSearchResultsButton=new Element('div',{'class':'clickable zoomToSearchResults','title':OpenRouteService.Preferences.translate('zoomToSearchResults')}).update(OpenRouteService.Preferences.translate('zoomToSearchResults'));$(this.zoomToSearchResultsButton).observe('click',function(){self.zoomToSearchResults();});this.responseContainer=new Element('div',{'class':'responseContainer'});this.htmlRepresentation.insert(this.responseContainer);this.selectResultPrompt=new Element('div',{'class':'prompt selectSearchResult'}).update(selectPrompt);this.responseContainer.insert(this.selectResultPrompt.hide());this.responseContainer.insert(this.zoomToSearchResultsButton.hide());var typingTimer;var self=this;Event.observe(this.searchfield,'keyup',function(e){clearTimeout(typingTimer);if(e.keyIdentifier!='Shift'&&self.searchfield.value){typingTimer=setTimeout(function(){self.openLSRequestCounter++;self.searchfield.addClassName('searching');document.getElementById('searchPlaceError').hide();var layerSearch=self.mapRepresentation.getLayersByName(OpenRouteService.Map.SEARCH)[0];layerSearch.clearMarkers();var geocodeService=new OpenRouteService.OpenLS.Geocode();geocodeService.buildRequest(self.searchfield.value,OpenRouteService.Preferences.language);geocodeService.requestData(function(){self.openLSRequestCounter--;if(self.openLSRequestCounter==0){var searchResponse=geocodeService.getResponse(self.options,self.resultClickOperation);self.updateResults(searchResponse);self.searchfield.removeClassName('searching');if(geocodeService.hasErrors){}}});},OpenRouteService.Gui.Search.DONE_TYPING_INTERVAL);}});document.observe('placeServerError:clicked',function(){self.displayServerError();});},hide:function(){this.htmlRepresentation.hide();var layerSearch=this.mapRepresentation.getLayersByName(OpenRouteService.Map.SEARCH)[0];layerSearch.clearMarkers();},show:function(){this.htmlRepresentation.show();},updateResults:function(response){if(this.options.routing==false){response.each(function(waypoint,i){Event.observe(response[i].useAsWaypoint,'click',function(){self.useAsWaypoint(response[i]);});});}
this.results=response;if(this._resultsHtml){try{this._resultsHtml.remove();}catch(e){}}
this.results.htmlRepresentation=new Element('ul',{'class':'guiComponent resultList SearchAddress'});var self=this;response.each(function(result){self.results.htmlRepresentation.insert(result.htmlRepresentation);});this._resultsHtml=this.results.htmlRepresentation;this.responseContainer.insert(this.results.htmlRepresentation);this.responseContainer.show();if(this.results.length>0){this.zoomToSearchResultsButton.show();this.selectResultPrompt.show();}else{this.zoomToSearchResultsButton.hide();this.selectResultPrompt.hide();}
if(this.mapResults){try{this.mapResults.destroy();}catch(e){}}
var layerSearchResults=this.mapRepresentation.getLayersByName(OpenRouteService.Map.SEARCH)[0];this.results.each(function(result){layerSearchResults.addMarker(result.mapRepresentation);});if(this.results.length==1){this.resultClickOperation(this.results[0]);}
this.zoomToSearchResults();},zoomToSearchResults:function(){var layerSearchResults=this.mapRepresentation.getLayersByName(OpenRouteService.Map.SEARCH)[0];this.options.map.zoomBoxToExtent(OpenRouteService.Ui.Elements.getFreeSpace(),layerSearchResults.getDataExtent());if(this.options.map.getZoom()>14){this.options.map.zoomTo(14);}},getSearchFieldContent:function(){return this.searchfield.value},setResultClickOperation:function(resultClickOperation){this.resultClickOperation=resultClickOperation;},clearResults:function(){if(this.results){this.responseContainer.remove(this.results.htmlRepresentation);this.results=null;}
this.mapResults=new OpenLayers.Layer.Markers('Search Results');this.searchfield.value="";},useAsWaypoint:function(selectedSearchResult){var routeInst=this.options.route.routeInstance;var wpCopy=routeInst.getNextAvailableWaypoint();wpCopy.shortTextRepresentation=selectedSearchResult.shortAddress;wpCopy.htmlRepresentation.removeClassName('highlight');selectedSearchResult.useAsWaypoint.hide();var sr=Element.clone(selectedSearchResult.htmlRepresentation,true);selectedSearchResult.useAsWaypoint.show();wpCopy.searchResult.update(sr);sr.removeClassName('highlight');wpCopy.gmlRepresentation=selectedSearchResult.point.cloneNode(true);var pos=OpenRouteService.Util.getElementsByTagNameNS(wpCopy.gmlRepresentation,OpenRouteService.namespaces.gml,'pos')[0];wpCopy.olRepresentation=OpenRouteService.convert.gml2ol.pos2point(pos,wpCopy.options.map.getProjection());sr.observe('mouseover',function(){if(wpCopy.mapRepresentation){wpCopy.route.layerRoutePoints.selectWaypoint.select(wpCopy.mapRepresentation);}});sr.observe('mouseout',function(){if(wpCopy.mapRepresentation){wpCopy.route.layerRoutePoints.selectWaypoint.unselect(wpCopy.mapRepresentation);}});wpCopy.resultMode(selectedSearchResult.lonlat);this.searchfield.value="";this.results=null;this.responseContainer.hide();var layerSearch=this.mapRepresentation.getLayersByName(OpenRouteService.Map.SEARCH)[0];layerSearch.clearMarkers();document.fire('showRoutePanel:clicked');},displayServerError:function(){document.getElementById('searchPlaceError').setAttribute('class','alert alert-error');document.getElementById('searchPlaceError').update(OpenRouteService.Preferences.translate('serverError'));document.getElementById('searchPlaceError').show();}});OpenRouteService.Gui.SearchPoi=Class.create(OpenRouteService.Gui,{searchfield:null,responseContainer:null,numberOfResults:null,mapRepresentation:null,route:null,resultClickOperation:function(){},results:null,refPoint:[],maxDist:null,distMeasure:null,selectedAsWaypoint:-1,openLSRequestCounter:0,initialize:function(options){var self=this;this.options=options||{};this.mapRepresentation=options.map;route=options.route;this.openLSRequestCounter=0;var selectPrompt=this.options.selectPrompt||'';var successCallback=function(){self.updateResults();};this.htmlRepresentation=new Element('div',{'class':'guiComponent Search'});var categoriesToDisplay=[];var div=document.createElement('div');var typeCategories=OpenRouteService.List.poiTypes.keys();for(var i=0;i<typeCategories.length;i++){var detailedTypes=OpenRouteService.List.poiTypes.get(typeCategories[i]);div.innerHTML=OpenRouteService.Preferences.translate(typeCategories[i]);var decoded=div.firstChild.nodeValue;categoriesToDisplay.push(decoded);for(var j=0;j<detailedTypes.length;j++){div.innerHTML=OpenRouteService.Preferences.translate(detailedTypes[j]);var decoded=div.firstChild.nodeValue;categoriesToDisplay.push(decoded);}}
var dataSource=categoriesToDisplay.toString().replace(/,/g,'","');dataSource='["'+dataSource+'"]';this.searchfield=new Element('input',{'type':'text','class':'searchField','placeholder':OpenRouteService.Preferences.translate('enterPoi'),'data-provide':'typeahead','data-items':'6','data-source':dataSource});this.inputWarn=new Element('div',{'id':'inputWarn','class':'alert alert-error'}).hide();this.htmlRepresentation.insert(this.inputWarn);this.checkboxWarn=new Element('div',{'id':'checkboxWarn','class':'alert alert-error'}).hide();this.htmlRepresentation.insert(this.checkboxWarn);this.htmlRepresentation.insert(this.searchfield);this.errorContainer=new Element('div',{'id':'searchPoiError'});this.htmlRepresentation.insert(this.errorContainer);document.observe('poiServerError:clicked',function(){self.displayServerError();});this.typingTimer=null;Event.observe(this.searchfield,'keyup',this.observeSearchfieldInput.bind(this));var self=this;document.observe('route:changed',function(){if(self.searchfield.value.length>0){self.observeSearchfieldInput();}});},observeSearchfieldInput:function(){clearTimeout(this.typingTimer);if(this.searchfield.value){var self=this;this.typingTimer=setTimeout(function(){self.searchfield.addClassName('searching');var layerPoi=self.mapRepresentation.getLayersByName(OpenRouteService.Map.POI)[0];layerPoi.clearMarkers();if(document.getElementById('searchNearRoute').checked==true&&route.routeInstance.getGmlRepresentation()!=null&&route.routeInstance.getGmlRepresentation().length>0){self.distMeasure=document.getElementById('distMeasurePoi').value;var dist=document.getElementById('maxDistToPoi').value;self.maxDist=OpenRouteService.Util.convertDistToMeters(dist,self.distMeasure);var routePoints=[];var allPts=this.route.routeInstance.olRepresentation;for(var i=0;i<allPts.length;i++){var newPt=new OpenLayers.Geometry.Point(allPts[i].x,allPts[i].y);routePoints.push(newPt.transform(new OpenLayers.Projection('EPSG:900913'),new OpenLayers.Projection('EPSG:4326')));}
var polygonService=new OpenRouteService.OpenLS.Polygon();polygonService.buildRequest(routePoints,self.maxDist);polygonService.requestData(function(){self.refPoint=polygonService.getResponse();self.requestResults();route.routeInstance.zoomToRoute();});}else{var pt=self.mapRepresentation.getCenter();pt=pt.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326"));self.refPoint=[];self.refPoint.push(pt);var width=self.mapRepresentation.calculateBounds().getWidth();var height=self.mapRepresentation.calculateBounds().getHeight();self.maxDist=width<height?width:height;self.maxDist/=2;self.requestResults();}},OpenRouteService.Gui.Search.DONE_TYPING_INTERVAL);}},hide:function(){this.htmlRepresentation.hide();var layerPoi=this.mapRepresentation.getLayersByName(OpenRouteService.Map.POI)[0];layerPoi.clearMarkers();},show:function(){this.htmlRepresentation.show();},requestResults:function(){this.errorContainer.hide();this.openLSRequestCounter++;var self=this;var poiService=new OpenRouteService.OpenLS.Poi();poiService.buildRequest(OpenRouteService.Preferences.language,this.searchfield.value,this.refPoint,this.maxDist);poiService.requestData(function(){self.openLSRequestCounter--;if(self.openLSRequestCounter==0){self.searchfield.removeClassName('searching');var txt=OpenRouteService.Preferences.reverseTranslate(self.searchfield.value);self.options.poisNearRoute=document.getElementById('searchNearRoute').checked==true||null==OpenRouteService.Util.isPoiCategory(OpenRouteService.Preferences.reverseTranslate(self.searchfield.value));self.options.distanceUnit=OpenRouteService.Preferences.distanceUnit;self.options.distanceUnit=self.options.distanceUnit.substring(0,self.options.distanceUnit.indexOf('/')).trim();var searchResponse=poiService.getResponse(self.options,self.resultClickOperation);self.updateResults(searchResponse);}});},updateResults:function(response){response.each(function(waypoint,i){Event.observe(response[i].useAsWaypoint,'click',function(){self.useAsWaypoint(response[i]);});});this.results=response;if(this._resultsHtml){try{this._resultsHtml.remove();}catch(e){}}
this.results.htmlRepresentation=new Element('ul',{'class':'guiComponent resultList searchPoi'})
var self=this;this.results.each(function(result){self.results.htmlRepresentation.insert(result.htmlRepresentation);});this._resultsHtml=this.results.htmlRepresentation;this.responseContainer=document.getElementById('poiResponseContainer');this.responseContainer.insert(this.results.htmlRepresentation);this.responseContainer.show();this.numberOfResults=document.getElementById('poiNumberOfResults');var numChildNodes=this.numberOfResults.childNodes.length;for(var i=0;i<numChildNodes;i++){this.numberOfResults.removeChild(this.numberOfResults.childNodes[i]);}
var newInformation=new Element('p');newInformation.insert(OpenRouteService.Preferences.translate('numPoiResults1')+this.results.length+OpenRouteService.Preferences.translate('numPoiResults2'));this.numberOfResults.appendChild(newInformation);this.numberOfResults.show();if(this.mapResults){try{this.mapResults.destroy();}catch(e){}}
var layerPoi=this.mapRepresentation.getLayersByName(OpenRouteService.Map.POI)[0];this.results.each(function(result){layerPoi.addMarker(result.mapRepresentation);});},getSearchFieldContent:function(){return this.searchfield.value},setResultClickOperation:function(resultClickOperation){this.resultClickOperation=resultClickOperation;},observeCheckbox:function(){if(document.getElementById('searchNearRoute').checked==true){if(!route.routeInstance.routePresent){document.getElementById('checkboxWarn').update(OpenRouteService.Preferences.translate('noRouteFound'));document.getElementById('checkboxWarn').show();}}else{document.getElementById('checkboxWarn').hide();}},observeInputfield:function(){this.distMeasure=document.getElementById('distMeasurePoi').value;var dist=document.getElementById('maxDistToPoi').value;this.maxDist=OpenRouteService.Util.convertDistToMeters(dist,this.distMeasure);if(parseInt(this.maxDist)>5000){document.getElementById('inputWarn').update(OpenRouteService.Preferences.translate('distaneNotSupported'));document.getElementById('inputWarn').show();}else{document.getElementById('inputWarn').hide();}},useAsWaypoint:function(selectedSearchResult){var self=this;var routeInst=self.options.route.routeInstance;var wpCopy=routeInst.getNextAvailableWaypoint();wpCopy.shortTextRepresentation=selectedSearchResult.shortAddress;wpCopy.htmlRepresentation.removeClassName('highlight');selectedSearchResult.useAsWaypoint.hide();var sr=Element.clone(selectedSearchResult.htmlForWaypoint,true);selectedSearchResult.useAsWaypoint.show();wpCopy.searchResult.update(sr);sr.removeClassName('highlight');var lonlat=selectedSearchResult.lonlat;lonlat.transform(new OpenLayers.Projection(this.options.map.getProjection()),new OpenLayers.Projection('EPSG:4326'));wpCopy.setPosition(lonlat.lon,lonlat.lat);sr.observe('mouseover',function(){if(wpCopy.mapRepresentation){wpCopy.route.layerRoutePoints.selectWaypoint.select(wpCopy.mapRepresentation);}});sr.observe('mouseout',function(){if(wpCopy.mapRepresentation){wpCopy.route.layerRoutePoints.selectWaypoint.unselect(wpCopy.mapRepresentation);}});wpCopy.resultMode(selectedSearchResult.lonlat);self.searchfield.value="";self.results=null;self.responseContainer.hide();var layerPoi=this.mapRepresentation.getLayersByName(OpenRouteService.Map.POI)[0];layerPoi.clearMarkers();self.numberOfResults.hide();document.fire('showRoutePanel:clicked');},displayServerError:function(){document.getElementById('searchPoiError').setAttribute('class','alert alert-error');document.getElementById('searchPoiError').update(OpenRouteService.Preferences.translate('serverError'));document.getElementById('searchPoiError').show();}});OpenRouteService.Gui.SearchResult=Class.create(OpenRouteService.Gui,{useAsWaypoint:function(){var self=this;self.useAsWaypoint.fire('click');}});OpenRouteService.Gui.SearchResult.Place=Class.create(OpenRouteService.Gui.SearchResult,{point:null,address:null,lonlat:null,mapRepresentation:null,htmlRepresentation:null,shortAddress:null,resultClickOperation:function(){},initialize:function(options,point,address,position){var self=this;this.options=options;this.point=point;this.address=address;this.htmlRepresentation=OpenRouteService.convert.xls2html.address2div(this.address);this.shortAddress=OpenRouteService.convert.xls2html.address2shortText(this.address);if(this.options.routing==false){this.useAsWaypoint=new Element('span',{'class':'clickable useAsWaypoint','title':OpenRouteService.Preferences.translate('useAsWaypoint')}).observe('click',this.useAsWaypoint.bind(this));this.htmlRepresentation.insert(this.useAsWaypoint);}
this.lonlat=OpenRouteService.convert.gml2ol.pos2lonLat(position,this.options.map.getProjection());var icons=OpenRouteService.Gui.icons;this.mapRepresentation=new OpenLayers.MarkerEm(this.lonlat,icons.result,icons.resultEm);$(this.htmlRepresentation).observe('mouseover',function(){self.mapRepresentation.emphasise();self.htmlRepresentation.addClassName('highlight')});$(this.htmlRepresentation).observe('mouseout',function(){self.mapRepresentation.deemphasise();self.htmlRepresentation.removeClassName('highlight')});$(this.htmlRepresentation).observe('click',function(){if(self.resultClickOperation&&typeof self.resultClickOperation==='function'&&!self.htmlRepresentation.hasClassName('resultMode')){self.resultClickOperation(self);}});},setResultClickOperation:function(resultClickOperation){this.resultClickOperation=resultClickOperation;}});OpenRouteService.Gui.SearchResult.Poi=Class.create(OpenRouteService.Gui.SearchResult,{mapRepresentation:null,htmlRepresentation:null,gmlRepresentation:null,lonlat:null,shortAddress:null,initialize:function(options,address,description){this.options=options;this.mapRepresentation=options.map;this.address=address;var point=OpenRouteService.Util.getElementsByTagNameNS(address,OpenRouteService.namespaces.gml,'Point')[0];point=OpenRouteService.Util.getElementsByTagNameNS(point,OpenRouteService.namespaces.gml,'pos')[0];this.htmlRepresentation=OpenRouteService.convert.xls2html.poi2div(address,this.options.poisNearRoute,this.options.distanceUnit);this.shortAddress=OpenRouteService.convert.xls2html.poi2shortText(address);this.htmlForWaypoint=OpenRouteService.convert.xls2html.poi2div(address,true,this.options.distanceUnit);this.useAsWaypoint=new Element('span',{'class':'clickable useAsWaypoint','title':OpenRouteService.Preferences.translate('useAsWaypoint')}).observe('click',this.useAsWaypoint.bind(this));this.htmlRepresentation.insert(this.useAsWaypoint);this.lonlat=OpenRouteService.convert.gml2ol.pos2lonLat(point,this.mapRepresentation.getProjection());var icon=OpenRouteService.Gui.poiIcons.get("poi_"+description);icon=icon?icon.clone():OpenRouteService.Gui.poiIcons.get("poi_default").clone();var self=this;self.setPosition(this.lonlat.lon,this.lonlat.lat);this.mapRepresentation=new OpenLayers.Marker(this.lonlat,icon);this.mapRepresentation.setOpacity(0.7);$(this.htmlRepresentation).observe('mouseover',function(){self.mapRepresentation.setOpacity(1);self.mapRepresentation.inflate(1.4);self.htmlRepresentation.addClassName('highlight')});$(this.htmlRepresentation).observe('mouseout',function(){self.mapRepresentation.setOpacity(0.7);self.mapRepresentation.inflate(0.715);self.htmlRepresentation.removeClassName('highlight')});$(this.htmlRepresentation).observe('click',function(){self.moveAndZoom();});},setResultClickOperation:function(resultClickOperation){this.resultClickOperation=resultClickOperation;},setPosition:function(lon,lat){this.olRepresentation=new OpenLayers.Geometry.Point(lon,lat);this.mapRepresentation=new OpenLayers.Feature(this.olRepresentation);if(null==this.gmlRepresentation){this.gmlRepresentation=OpenRouteService.Util.parseStringToDOM('<gml:Point xmlns:gml="http://www.opengis.net/gml"> <gml:pos srsName="EPSG:4326">8.0 51.0</gml:pos> </gml:Point>').firstChild;}},moveAndZoom:function(){var lonlat=new OpenLayers.LonLat(this.olRepresentation.x,this.olRepresentation.y);this.options.map.moveTo(lonlat);this.options.map.zoomTo(18);}});OpenRouteService.Gui.Tool=Class.create(OpenRouteService.Gui,{});OpenRouteService.Gui.Tool.Accessibility=Class.create(OpenRouteService.Gui.Tool,{initialize:function(options){var self=this;options=options||{};this.htmlRepresentation=new Element('div',{'id':options.id||'none'});var t='<br>';for(var i=0;i<50;++i){t+='text<br>'};this.htmlRepresentation.update('Accessibility Tool'+t);}});OpenRouteService.Gui.Tool.CurrentLocation=Class.create(OpenRouteService.Gui.Tool,{initialize:function(options){var self=this;options=options||{};this.htmlRepresentation=new Element('div',{'id':options.id||'none'});this.htmlRepresentation.update(new Element('div',{'class':'toolHeading'}).update(options.title));this.geolocation=new OpenRouteService.Gui.Geolocation(options);this.htmlRepresentation.insert(this.geolocation.htmlRepresentation);}});OpenRouteService.Gui.Tool.Routing=Class.create(OpenRouteService.Gui.Tool,{initialize:function(options){var self=this;options=options||{};options.id=options.id||'none';this.id=options.id||'none';var panelId=options.id+'Panel'||'none';this.htmlRepresentation=new Element('div',{'id':panelId});this.routeInstance=new OpenRouteService.Gui.Route(options);this.htmlRepresentation.insert(this.routeInstance.htmlRepresentation);},calculateRoute:function(){return this.routeInstance.calculateRoute();}});OpenRouteService.Gui.Tool.SearchPlace=Class.create(OpenRouteService.Gui.Tool,{initialize:function(options){var self=this;options=options||{};this.htmlRepresentation=new Element('div',{'id':options.id||'none'});this.htmlRepresentation.update(new Element('div',{'class':'toolHeading'}).update(options.title));options.routing=false;this.Search=new OpenRouteService.Gui.SearchPlace(options);this.htmlRepresentation.insert(this.Search.htmlRepresentation);}});OpenRouteService.Gui.Tool.SearchPoi=Class.create(OpenRouteService.Gui.Tool,{initialize:function(options){var self=this;options=options||{};this.htmlRepresentation=new Element('div',{'id':options.id||'none'});this.htmlRepresentation.update(new Element('div',{'class':'toolHeading'}).update(options.title));var poiNearRoute=new Element('span',{'id':'poiNearRoute'});var check=new Element('input',{'type':'checkbox','class':'checkbox','id':'searchNearRoute'});check.checked=false;check.observe('click',function(){self.SearchPoi.observeCheckbox();self.SearchPoi.observeSearchfieldInput();});var distanceToRoute=new Element('input',{'type':'text','id':'maxDistToPoi','class':'textfield','value':'100'});distanceToRoute.observe('keyup',function(){self.SearchPoi.observeInputfield();if(document.getElementById('searchNearRoute').checked==true){self.SearchPoi.observeSearchfieldInput();}});var distanceMeasure=new Element('select',{'id':'distMeasurePoi'});var units=OpenRouteService.List.distanceUnits;for(var i=0;i<units.length;i++){distanceMeasure.add(new Option(units[i],units[i]),null);}
distanceMeasure.observe('change',function(){self.SearchPoi.observeInputfield();if(document.getElementById('searchNearRoute').checked==true){self.SearchPoi.observeSearchfieldInput();}});poiNearRoute.insert(check);poiNearRoute.insert("&nbsp;"+OpenRouteService.Preferences.translate("poiNearRoute1"));poiNearRoute.insert(distanceToRoute);poiNearRoute.insert(distanceMeasure);poiNearRoute.insert(OpenRouteService.Preferences.translate("poiNearRoute2"));this.htmlRepresentation.insert(poiNearRoute);this.SearchPoi=new OpenRouteService.Gui.SearchPoi(options);this.htmlRepresentation.insert(this.SearchPoi.htmlRepresentation);this.numberOfResults=new Element('div',{'id':'poiNumberOfResults'}).hide();this.htmlRepresentation.insert(this.numberOfResults);this.responseContainer=new Element('div',{'class':'responseContainer panel panelMedium','id':'poiResponseContainer'}).hide();this.htmlRepresentation.insert(this.responseContainer);}});OpenRouteService.Gui.Waypoint=Class.create(OpenRouteService.Gui,{htmlRepresentation:null,olRepresentation:null,mapRepresentation:null,shortTextRepresentation:null,search:null,initialize:function(options,layer,route){this.options=options;this.layer=layer;this.route=route;this.mapRepresentation=options.map;this.htmlRepresentation=new Element('div',{'class':'guiComponent waypoint',draggable:true});this.moveUpButton=new Element('span',{'class':'clickable moveUpWaypoint','href':'#','title':OpenRouteService.Preferences.translate('moveUpWaypoint')}).observe('click',this.moveUp.bind(this));this.moveDownButton=new Element('span',{'class':'clickable moveDownWaypoint','href':'#','title':OpenRouteService.Preferences.translate('moveDownWaypoint')}).observe('click',this.moveDown.bind(this));this.closeButton=new Element('span',{'class':'clickable closeButton','title':OpenRouteService.Preferences.translate('removeWaypoint')}).observe('click',this.remove.bind(this));this.searchAgainButton=new Element('span',{'class':'clickable searchAgainButton','title':OpenRouteService.Preferences.translate('searchAgain')}).observe('click',this.toggleSearchResultModes.bind(this));this.searchAgainButton.hide();this.htmlRepresentation.insert(this.closeButton);this.htmlRepresentation.insert(this.moveUpButton);this.htmlRepresentation.insert(this.moveDownButton);this.htmlRepresentation.insert(this.searchAgainButton);this.olRepresentation=null;this.gmlRepresentation=null;this.pointType=null;this.searchResult=new Element('div').hide();this.htmlRepresentation.insert(this.searchResult);options.selectPrompt=OpenRouteService.Preferences.translate('selectResult');options.routing=true;this.search=new OpenRouteService.Gui.SearchPlace(options);this.htmlRepresentation.insert(this.search.htmlRepresentation);this.setResultClickOperation();},setResultClickOperation:function(){var self=this;this.search.setResultClickOperation(function(result){self.shortTextRepresentation=result.shortAddress;self.htmlRepresentation.removeClassName('highlight');var sr=Element.clone(result.htmlRepresentation,true);self.searchResult.update(sr);sr.removeClassName('highlight');self.gmlRepresentation=result.point.cloneNode(true);var pos=OpenRouteService.Util.getElementsByTagNameNS(self.gmlRepresentation,OpenRouteService.namespaces.gml,'pos')[0];self.olRepresentation=OpenRouteService.convert.gml2ol.pos2point(pos,self.options.map.getProjection());sr.observe('mouseover',function(){if(self.mapRepresentation){self.route.routePoints.selectWaypoint.select(self.mapRepresentation);}});sr.observe('mouseout',function(){if(self.mapRepresentation){self.route.routePoints.selectWaypoint.unselect(self.mapRepresentation);}});self.resultMode(result.lonlat);});},searchMode:function(){this.searchAgainButton.hide();this.htmlRepresentation.removeClassName('highlight');if(this.mapRepresentation){this.layer.removeFeatures([this.mapRepresentation]);}
this.search.show();this.searchResult.hide();this.route.setPointTypes();},resultMode:function(){this.searchAgainButton.show();this.search.hide();this.searchResult.show();this.route.setPointTypes();this.route.checkWaypointsAndCalcRoute();},toggleSearchResultModes:function(){if(!this.searchResult.visible()){this.resultMode();}else{this.searchMode();}},moveUp:function(){var thisIndex=this.route.waypoints.indexOf(this);var swapIndex=thisIndex-1;var waypoints=this.route.waypoints;if(swapIndex>=0){var previous=this.htmlRepresentation.previousSibling
previous.insert({before:this.htmlRepresentation});var tmp=waypoints[swapIndex];waypoints[swapIndex]=waypoints[thisIndex];waypoints[thisIndex]=tmp;this.route.setPointTypes();this.route.checkWaypointsAndCalcRoute();}},moveDown:function(){var thisIndex=this.route.waypoints.indexOf(this);var swapIndex=thisIndex+1;var waypoints=this.route.waypoints;if(swapIndex<waypoints.length){var next=this.htmlRepresentation.nextSibling
next.insert({after:this.htmlRepresentation});var tmp=waypoints[swapIndex];waypoints[swapIndex]=waypoints[thisIndex];waypoints[thisIndex]=tmp;this.route.setPointTypes();this.route.checkWaypointsAndCalcRoute();}},remove:function(){this.reset();this.route.setPointTypes();this.route.fillUpWaypoints();this.route.checkWaypointsAndCalcRoute();},reset:function(){var self=this;$(this.htmlRepresentation).remove();if(this.mapRepresentation){this.layer.removeFeatures([this.mapRepresentation]);}
this.route.waypoints=this.route.waypoints.reject(function(Object){return Object===self});},setMarker:function(){if(OpenRouteService.Gui.icons[this.pointType]&&this.gmlRepresentation){this.icon=OpenRouteService.Gui.icons[this.pointType].clone();}else{this.icon=OpenRouteService.Gui.icons['unset'].clone();}
if(this.mapRepresentation){this.layer.removeFeatures([this.mapRepresentation]);}
if(this.olRepresentation){this.mapRepresentation=new OpenLayers.Feature.Vector(this.olRepresentation,null);this.mapRepresentation.jsRepresentation=this;this.mapRepresentation.pointType=this.pointType;this.layer.addFeatures([this.mapRepresentation]);}},setPointType:function(pointType){this.htmlRepresentation.removeClassName(this.pointType);this.pointType=pointType;this.htmlRepresentation.addClassName(this.pointType);this.setMarker();},setPosition:function(lon,lat,srsName){this.layer.removeFeatures([this.mapRepresentation]);if(!srsName)
srsName='EPSG:4326';if(this.olRepresentation){this.olRepresentation.x=lon;this.olRepresentation.y=lat;window.m=this.options.map;this.olRepresentation.transform(new OpenLayers.Projection(srsName),new OpenLayers.Projection(this.options.map.getProjection()));}else{this.olRepresentation=new OpenLayers.Geometry.Point(lon,lat).transform(new OpenLayers.Projection(srsName),new OpenLayers.Projection(this.options.map.getProjection()));}
this.mapRepresentation=new OpenLayers.Feature(this.olRepresentation);this.layer.addFeatures([this.mapRepresentation]);this.gmlRepresentation=OpenRouteService.Util.parseStringToDOM('<gml:Point xmlns:gml="http://www.opengis.net/gml"> <gml:pos srsName="EPSG:4326">8.0 51.0</gml:pos> </gml:Point>').firstChild;this.gmlRepresentation.firstElementChild.textContent=lon+' '+lat;window.wp=this;this.resultMode();this.reverseGeocode();},reverseGeocode:function(){var self=this;var geocodeService=new OpenRouteService.OpenLS.ReverseGeocode();geocodeService.buildRequest(this.gmlRepresentation,OpenRouteService.Preferences.language);geocodeService.requestData(function(){geocodeService.getResponse(self);});this.route.checkWaypointsAndCalcRoute();this.search.clearResults();},equals:function(that){if(this.gmlRepresentation==that.gmlRepresentation){return true;}else{return false;}}});OpenRouteService.Gui.Waypoint.UNSET='unset';OpenRouteService.Gui.Waypoint.START='start';OpenRouteService.Gui.Waypoint.VIA='via';OpenRouteService.Gui.Waypoint.END='end';OpenRouteService.Ui=(function(){var routing;var initialize=function(options){var getParams=null;if(options&&options.getParams){getParams=options.getParams}
insertToggleSidebar(options.map);insertSidebarContent(this,getParams,options.map);insertTopMenu();}
var insertTopMenu=function(){var liElement=new Element('li');document.getElementById('topMenu').appendChild(liElement);var child=document.getElementById('topMenu').firstChild;var cm=new OpenRouteService.CookieManager();var result=cm.readCookie(cm.cookieNameVersion);if(!result){var infoElement=new Element('div',{'class':'alert alert-info','id':'infoVersions'});var closeBtn=new Element('button',{'type':'button','class':'close','data-dismiss':'alert'}).insert('&times;');var infoTxt=OpenRouteService.Preferences.translate('infoTextVersions');infoElement.insert(closeBtn);infoElement.insert(infoTxt);liElement.appendChild(infoElement);document.getElementById('topMenu').insertBefore(liElement,child);}
var liElement=new Element('li');var navElement=new Element('a');navElement.setAttribute('href','#sitePrefsModal');navElement.setAttribute('data-toggle','modal');navElement.innerHTML=OpenRouteService.Preferences.translate('sitePreferences');liElement.appendChild(navElement);document.getElementById('topMenu').insertBefore(liElement,child);liElement=new Element('li');navElement=new Element('a');navElement.setAttribute('href','contact.html#top');navElement.setAttribute('target','_blank');navElement.innerHTML=OpenRouteService.Preferences.translate('contact');liElement.appendChild(navElement);document.getElementById('topMenu').insertBefore(liElement,child);document.body.insert(new OpenRouteService.Gui.PreferencePopup(routing).htmlRepresentation);}
var insertToggleSidebar=function(map){var hideSidebar=new Element('a',{'class':'sidebarVisible','id':'toggleSidebar'});hideSidebar.innerHTML="<img src='img/arrowLeft.png' alt="+OpenRouteService.Preferences.translate("hideSidebar")+"/>";hideSidebar.observe('click',function(){var side=document.getElementById('sidebar');if(side.style.display=='none'){document.getElementById('sidebar').style.display='inline';document.getElementById('openlayers').style.left='415px';document.getElementById('toggleSidebar').setAttribute('class','sidebarVisible');map.updateSize();}else{document.getElementById('sidebar').style.display='none';document.getElementById('openlayers').style.left='25px';document.getElementById('toggleSidebar').setAttribute('class','sidebarInvisible');map.updateSize();}});document.body.appendChild(hideSidebar);}
var insertSidebarContent=function(self,getParams,map){var sidebar=document.getElementById("sidebar");var routingPanel=new OpenRouteService.Gui.Panel({id:'route',visible:'true',img:'img/menuRoute.png',title:OpenRouteService.Preferences.translate('routePlanner')});var searchPanel=new OpenRouteService.Gui.Panel({id:'search',visible:'false',img:'img/menuSearch.png',title:OpenRouteService.Preferences.translate('search')});document.getElementById("sidebar").appendChild(routingPanel.htmlRepresentation);document.getElementById("sidebar").appendChild(searchPanel.htmlRepresentation);self.Elements.routing=new OpenRouteService.Gui.Tool.Routing({id:'routing',title:OpenRouteService.Preferences.translate('planRoute'),map:map,waypoints:getParams.waypoints||null,routeOpt:getParams.routeOpt||null,motorways:getParams.motorways||null,tollways:getParams.tollways||null,avoidAreas:getParams.avoidAreas||null});routing=self.Elements.routing;self.Elements.routing.htmlRepresentation.setAttribute('class','panel panelLight');routingPanel.appendChild(self.Elements.routing.htmlRepresentation);self.Elements.currentLocation=new OpenRouteService.Gui.Tool.CurrentLocation({id:'currentLocation',title:OpenRouteService.Preferences.translate('currentLocation'),map:map,route:self.Elements.routing});self.Elements.currentLocation.htmlRepresentation.setAttribute('class','panel panelLight');searchPanel.appendChild(self.Elements.currentLocation.htmlRepresentation);self.Elements.searchPlace=new OpenRouteService.Gui.Tool.SearchPlace({id:'searchPlace',title:OpenRouteService.Preferences.translate('searchForPoints'),map:map,route:self.Elements.routing});self.Elements.searchPlace.htmlRepresentation.setAttribute('class','panel panelLight');var errorContainer=new Element('div',{'id':'searchPlaceError'});self.Elements.searchPlace.htmlRepresentation.insert(errorContainer);searchPanel.appendChild(self.Elements.searchPlace.htmlRepresentation);self.Elements.searchPoi=new OpenRouteService.Gui.Tool.SearchPoi({id:'searchPoi',title:OpenRouteService.Preferences.translate('searchForPoi'),map:map,route:self.Elements.routing});self.Elements.searchPoi.htmlRepresentation.setAttribute('class','panel panelLight');searchPanel.appendChild(self.Elements.searchPoi.htmlRepresentation);document.observe('showRoutePanel:clicked',function(){searchPanel.hidePanel();routingPanel.showPanel();});}
return{initialize:initialize};}());OpenRouteService.Ui.Elements={getFreeSpace:function(){var mapElement=document.getElementById('openlayers');return[mapElement.offsetLeft,mapElement.offsetHeight,mapElement.offsetWidth,mapElement.offsetTop];}};var lang_de={'asdf':'deutsch-asdf','serverError':'Sorry, w&auml;rend der Berechnung ist ein Fehler auf dem Server passiert. Bitte versuchen Sie es sp&auml;ter noch einmal ','contact':'Info&nbsp;&amp;&nbsp;Kontakt','closeBtn':'Schlie&szlig;en','saveBtn':'Speichern','untitled':'Unbenannt','infoTextVersions':'Neu auf OpenRouteService? Nutzen Sie erweiterte Routen-Optionen ber die Seiteneinstellungen. ','routePlanner':'Routen-Planer ','search':'Suche','routeOptions':'Art der Route','routeExtras':'Route-Extras','planRoute':'Route planen','calculatingRoute':'Route wird berechnet...','noRouteAvailable':'Leider konnte keine Route zwischen den gew&auml;hlten Punkten berechnet werden. Bitte w&auml;hlen Sie Ihre Punkte in der N&auml;he eines Weges.','routeFromTo':'Route nach ','resetRoute':'Gesamte Route l&ouml;schen ','TotalTime':'Gesamte Reisezeit','TotalDistance':'Gesamte Wegstrecke','zoomToRoute':'Ganze Route','routeSummary':'Zusammenfassung','routeInstructions':'Wegbeschreibung','routeLinkText':'Permalink zur aktuellen Route','geolocationNotification':'Der Routenplaner versucht Ihren Standort zu bestimmen. Wenn Sie die Anfrage nicht best&auml;tigen, werden Sie in K&uuml;rze weitergeleitet.','currentLocation':'Meine aktuelle Position','geolocation':'Mein Aufenhaltsort','showCurrentLocation':'Aktuellen Ort zeigen','geolocationNotSupported':'Diese Funktionalit&auml;t wird von Ihrem Browser leider nicht unterst&uuml;tzt.','geolocationRuntimeError':'W&auml;hrend der Standortabfrage ist leider ein Fehler aufgetreten!','zoomToSearchResults':'Ergebnisse in der Karte anzeigen','selectResult':'W&auml;hlen Sie ein Suchergebnis aus:','searchAgain':'erneut Suchen','searchForPoints':'Nach Adresse suchen','enterAddress':'Addresse eingeben','distaneNotSupported':'Maximalwert: 5000 Meter','noRouteFound':'Keine Route vorhanden, in deren N&auml;he POIs gesuche werden k&ouml;nnen.','searchForPoi':'Nach POI suchen','poiNearRoute1':'markiere POIs im Umkreis von&nbsp;','poiNearRoute2':'&nbsp; zur Route','enterPoi':'POI eingeben','numPoiResults1':'<b>','numPoiResults2':' Ergebnisse gefunden</b> (max. 100):','useAsStartPoint':'Als Startpunkt verwenden','useAsViaPoint':'Als Viapunkt einf&uuml;gen','useAsEndPoint':'Als Zielpunkt verwenden','addWaypoint':'Wegpunkt hinzuf&uuml;gen','moveUpWaypoint':'Wegpunkt nach Oben verschieben','moveDownWaypoint':'Wegpunkt nach Unten verschieben','removeWaypoint':'Wegpunkt entfernen','useAsWaypoint':'als Wegpunkt &uuml;bernehmen','Shortest':'K&uuml;rzester Weg','Fastest':'Schnellster Weg','Pedestrian':'Fug&auml;nger','Bicycle':'K&uuml;rzester Weg','BicycleSafety':'Sicherster Weg','BicycleRoute':'Bevorzugter Fahrradweg','BicycleMTB':'Mountainbike','BicycleRacer':'Rennrad','avoidMotorways':'Autobahnen vermeiden','avoidTollways':'Mautstra&szlig;en vermeiden','avoidAreas':'Bereiche vermeiden','avoidAreaDraw':'Bereich zeichnen','avoidAreaModify':'Bereich bearbeiten','avoidAreaRemove':'Bereich l&ouml;schen','gpxDownloadError':'Beim Herunterladen der Route ist leider ein Fehler aufgetreten.','gpxUploadError':'Beim Upload der Route ist leider ein Fehler aufgetreten.','gpxDownloadText':'Aktuelle Route im GPX-Format herunterladen','gpxUploadRouteText':'GPX-Route aus Datei anzeigen und neuberechnen','gpxUploadTrackText':'GPX-Track aus Datei anzeigen','de':'Deutsch','en':'Englisch','es':'Spanisch','fr':'Franz&ouml;sisch','km':'Kilometer','KM':'Kilometer','m':'Meter','M':'Meter','mi':'Meilen','MI':'Meilen','yd':'Yards','YD':'Yards','days':'Tag(e)','hours':'Stunde(n)','minutes':'Minute(n)','seconds':'Sekunde(n)','standardVersion':'Standard Version','extendedVersion':'Erweiterte Version','sitePreferences':'Seiteneinstellungen','language':'Sprachen','distance':'Entfernungseinheiten','version':'Version','languageText':'Bitte w&auml;hlen Sie Ihre Sprache:&nbsp;','distanceText':'Bitte w&auml;hlen Sie Ihre Entfernungseinheit:&nbsp;','versionText':'Bitte w&auml;hlen Sie den Detail-Grad:&nbsp;','amenity':'Einrichtungen','public_tran':'&Ouml;pnv','shop':'L&auml;den','tourism':'Tourismus','leisure':'Freizeit','sport':'Sport','atm':'Geldautomat','bank':'Bank','bureau_de_change':'Wechselstube','biergarten':'Biergarten','cafe':'Cafe','cinema':'Kino','college':'Hochschule','courthouse':'Gericht','fast_food':'Schnellrestaurant','fuel':'Tankstelle','hospital':'Krankenhaus','library':'B&uuml;cherei','nightclub':'Nachtclub','parking':'Parkplatz','pharmacy':'Apotheke','place_of_worship':'Kultst&auml;tte','police':'Polizei','post_box':'Briefkasten','post_office':'Postamt','pub':'Kneipe','public_building':'&Ouml;ffentliches Geb&auml;ude','restaurant':'Restaurant','school':'Schule','taxi':'Taxi','telephone':'Telephonzelle','theatre':'Theater','toilets':'Toiletten','townhall':'Rathaus','university':'Universit&auml;t','bus_stop':'Bus Haltestelle','bus_station':'Busbahnhof','railway_station':'Bahnhof','tram_stop':'Stra&szlig;enbahnhaltestelle','subway_entrance':'U-Bahn-Einstieg','supermarket':'Supermarkt','convenience':'Konsumg&uuml;ter','bakery':'B&auml;ckerei','butcher':'Metzger','kiosk':'Kiosk','camp_site':'Campingplatz','caravan_site':'Stellplatz','chalet':'H&uuml;tte','viewpoint':'Aussichtspunkt','information':'Information','hotel':'Hotel','motel':'Motel','guest_house':'G&auml;stehaus','hostel':'Hostel','sports_centre':'Sportcenter','golf_course':'Golfplatz','stadium':'Stadion','track':'Bahn','pitch':'Bolzplatz','water_park':'Wasserpark','marina':'Yachthafen','slipway':'Eisbahn','fishing':'Fischen','nature_reserve':'Naturschutzgebiet','park':'Park','playground':'Spielplatz','garden':'Garten','ice_rink':'Eissporthalle','miniature_golf':'Minigolf','9pin':'Bowling (9 Pin)','10pin':'Bowling (10 Pin)','archery':'Bogenschie&szlig;en','athletics':'Athletik','australian_football':'Australischer Football','baseball':'Baseball','basketball':'Basketball','beachvolleyball':'Beachvolleyball','boules':'Boule','bowls':'Rasen-Bowling','canoe':'Kanu','chess':'Schach','climbing':'Klettern','cricket':'Cricket','cricket_nets':'Cricket Nets','croquet':'Krocket','cycling':'Radfahren','diving':'Tauchen','dog_racing':'Hunderennen','equestrian':'Reiten','football':'American Football','golf':'Golf','gymnastics':'Gymnastik','hockey':'Hockey','horse_racing':'Pferderennen','korfball':'Korfball','motor':'Motorsport','orienteering':'Orientierungslauf','paddle_tennis':'Paddle Tennis','squash':'Squash','paragliding':'Paragliding','pelota':'Pelota','racquet':'Racquetball','rowing':'Rudern','rugby':'Rugby','shooting':'Schie&szlig;sport','skating':'Rollschuhfahren','skateboard':'Skateboard','skiing':'Skisport','soccer':'Fu&szlig;ball','swimming':'Schwimmen','table_tennis':'Tischtennis','team_handball':'Handball','tennis':'Tennis','volleyball':'Volleyball'};var lang_en={'serverError':'We are sorry. An error occured during the calculations on the server. Please try again later.','contact':'Info&nbsp;&amp;&nbsp;Contact','closeBtn':'Close','saveBtn':'Save','untitled':'Untitled','infoTextVersions':'New to OpenRouteService? Activate extended options in the site preference menu.','routePlanner':'Plan Route','search':'Search','routeOptions':'Route options','routeExtras':'Route extras','planRoute':'Plan route','calculatingRoute':'Calculating Route...','noRouteAvailable':'Sorry, no route was found between the selected points. Please choose your points closer to a road.','routeFromTo':'Route to ','resetRoute':'Reset whole route','TotalTime':'Total time','TotalDistance':'Total distance','zoomToRoute':'Whole Route','routeSummary':'Summary','routeInstructions':'Route instructions','routeLinkText':'Permalink for current route','geolocationNotification':'The routing planner tries to find out your location. If you do not want to accept the request, you will be redirected in a moment.','currentLocation':'My current location','geolocation':'My location','showCurrentLocation':'Show my current location','geolocationNotSupported':'Your browser does not support this feature.','geolocationRuntimeError':'An error occured during the location checking, we\'re sorry!','zoomToSearchResults':'Zoom to search results','selectResult':'Select a result:','searchAgain':'search Again','searchForPoints':'Search for an address','enterAddress':'enter an address','distaneNotSupported':'maximum distance: 5000 meters','noRouteFound':'No route to search for POIs nearby.','searchForPoi':'Search for a POI','poiNearRoute1':'find POIs within&nbsp;','poiNearRoute2':'&nbsp; next to the route','enterPoi':'enter a POI','numPoiResults1':'<b>Number of Results: ','numPoiResults2':' </b>(max. 100):','useAsStartPoint':'use as starting point','useAsViaPoint':'insert as via point','useAsEndPoint':'use as destination','addWaypoint':'Add waypoint','moveUpWaypoint':'Move waypoint up','moveDownWaypoint':'Move Waypoint down','removeWaypoint':'Remove waypoint','useAsWaypoint':'use as waypoint','Shortest':'shortest route','Fastest':'fastest route','Pedestrian':'pedestrian','Bicycle':'shortest route','BicycleSafety':'safest route','BicycleRoute':'preferred bicycle lane','BicycleMTB':'mountain bike','BicycleRacer':'racing bike','avoidMotorways':'Avoid highways','avoidTollways':'Avoid toll roads','avoidAreas':'Areas to avoid','avoidAreaDraw':'draw avoid area','avoidAreaModify':'modify avoid area','avoidAreaRemove':'remove avoid area','gpxDownloadError':'Unfortunately an error occured when downlodng the route.','gpxUploadError':'Unfortunately an error occured when uploading the route.','gpxDownloadText':'Download of current route in GPX format','gpxUploadRouteText':'Upload a route from a GPX-file with re-calculation','gpxUploadTrackText':'Upload of GPX-track for display on the map','de':'German','en':'English','fr':'French','km':'kilometers','KM':'kilometers','m':'meters','M':'meters','mi':'miles','MI':'miles','yd':'yards','YD':'yards','days':'day(s)','hours':'hour(s)','minutes':'minute(s)','seconds':'second(s)','standardVersion':'standard version','extendedVersion':'extended version','sitePreferences':'Site Preferences','language':'Languages','distance':'Distance Units','version':'Version','languageText':'Please select your language:&nbsp;','distanceText':'Please select your distance unit:&nbsp;','versionText':'Please choose the number of options:&nbsp;','amenity':'amenity','public_tran':'public transportation','shop':'shops','tourism':'tourism','leisure':'leisure','sport':'sports','atm':'ATM','bank':'bank','bureau_de_change':'bureau de change','biergarten':'beer garden','cafe':'cafe','cinema':'cinema','college':'college','courthouse':'courthouse','fast_food':'fast food','fuel':'fueling station','hospital':'hospital','library':'library','nightclub':'night club','parking':'parking','pharmacy':'pharmacy','place_of_worship':'place of worship','police':'police','post_box':'post box','post_office':'post office','pub':'pub','public_building':'public building','restaurant':'restaurant','school':'school','taxi':'taxi','telephone':'telephone','theatre':'theatre','toilets':'public restroom','townhall':'town hall','university':'university','bus_stop':'bus stop','bus_station':'bus station','railway_station':'railway station','tram_stop':'tram stop','subway_entrance':'subway entrance','supermarket':'supermarket','convenience':'convenience','bakery':'bakery','butcher':'butcher','kiosk':'kiosk','camp_site':'camp site','caravan_site':'caravan site','chalet':'chalet','viewpoint':'viewpoint','information':'information','hotel':'hotel','motel':'motel','guest_house':'guest house','hostel':'hostel','sports_centre':'sports centre','golf_course':'golf course','stadium':'stadium','track':'track','pitch':'pitch','water_park':'water park','marina':'marina','slipway':'slipway','fishing':'fishing','nature_reserve':'nature reserve','park':'park','playground':'playground','garden':'garden','ice_rink':'ice rink','miniature_golf':'miniature golf','9pin':'bowling (9 pin)','10pin':'bowling (10 pin)','archery':'archery','athletics':'athletics','australian_football':'australian football','baseball':'baseball','basketball':'basketball','beachvolleyball':'beachvolleyball','boules':'boules','bowls':'bowls','canoe':'canoe','chess':'chess','climbing':'climbing','cricket':'cricket','cricket_nets':'cricket nets','croquet':'croquet','cycling':'cycling','diving':'diving','dog_racing':'dog racing','equestrian':'equestrian','football':'american football','golf':'golf','gymnastics':'gymnastics','hockey':'hockey','horse_racing':'horse racing','korfball':'korfball','motor':'motor sports','orienteering':'orienteering','paddle_tennis':'paddle tennis','squash':'squash','paragliding':'paragliding','pelota':'pelota','racquet':'racquet ball','rowing':'rowing','rugby':'rugby','shooting':'shooting','skating':'skating','skateboard':'skateboarding','skiing':'skiing','soccer':'football','swimming':'swimming','table_tennis':'table tennis','team_handball':'team handball','tennis':'tennis','volleyball':'volleyball',};